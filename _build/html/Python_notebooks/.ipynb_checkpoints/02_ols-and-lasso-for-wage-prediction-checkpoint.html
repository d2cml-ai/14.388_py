
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>2. OLS and lasso for wage prediction &#8212; Inference on Causal and Structural Parametters Using ML and AI</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. OLS and lasso for gender wage gap inference" href="03_ols-and-lasso-for-gender-wage-gap-inference.html" />
    <link rel="prev" title="1. Linear Model Overfiting" href="01_Python_Notebook_Linear_Model_Overfitting.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/main_logo_ai_light.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Inference on Causal and Structural Parametters Using ML and AI</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_Python_Notebook_Linear_Model_Overfitting.html">
   1. Linear Model Overfiting
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   2. OLS and lasso for wage prediction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_ols-and-lasso-for-gender-wage-gap-inference.html">
   3. OLS and lasso for gender wage gap inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_py-notebook-some-rct-examples.html">
   4. Some RCT Examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_py-notebook-analyzing-rct-with-precision.html">
   5. Analyzing RCT reemployment experiment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_analyzing-rct-reemployment-experiment.html">
   6. Analyzing RCT reemployment experiment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_py-notebook-linear-penalized-regs.html">
   7. Linear Penalized Regs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_ML_for_wage_prediction.html">
   8. ML for wage prediction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_py-notebook-experiment-on-orthogonal-learning.html">
   9. Experiment on orthogonal Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_double-lasso-for-the-convergence-hypothesis.html">
   10. Double Lasso for Testing the Convergence Hypothesis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11_py-heterogenous-wage-effects.html">
   11. Heterogenous Wage Effects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12_py-colliderbias-hollywood.html">
   12. ColliderBias Hollywood# Collider Bias
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13_deep_neural_networks_for_wage_prediction.html">
   13. Deep Neural Networks for Wage Prediction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="14_automl-for-wage-prediction.html">
   14. AutoML for wage prediction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15_py-Functional-Approximation-By-NN-and-RF.html">
   15. Functional Approximation By NN and RF
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="16_notebook_dagitty.html">
   16. Notebook-DAGitty
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="17_notebook-dosearch.html">
   17. Notebook-Dosearch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="18_pm3_notebook_inference_clustering.html">
   18. DML inference for gun ownership
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="19_pm3_notebook_inference_nn.html">
   19. DML inference using NN for gun ownership
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="20_pm5-401k-kaggle-py.html">
   20. DML for ATE and LATE of 401(k) on Wealth
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="21_Identification%20Analysis%20of%20401%28k%29%20Example%20w%20DAGs.html">
   21. Identification Analysis of 401(k) Example w DAGs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="22_debiased-ml-for-partially-linear-model-in-python.html">
   22. Debiased ML for Partially Linear Model in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="23_sensitivity_analysis_with_sensmakr_and_debiased_ml.html">
   23. Sensitivity Analysis with Sensmakr and Debiased ML
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="24_debiased-ml-for-partially-linear-iv-model-in-python.html">
   24. Debiased ML for Partially Linear IV Model in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="25_r_weak_iv_experiments.html">
   25. Weak IV Experiments
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/d2cml-ai/14.388_py/master?urlpath=tree/_build/jupyter_execute/Python_notebooks/02_ols-and-lasso-for-wage-prediction.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/d2cml-ai/14.388_py/blob/master/_build/jupyter_execute/Python_notebooks/02_ols-and-lasso-for-wage-prediction.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/d2cml-ai/14.388_py"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/d2cml-ai/14.388_py/issues/new?title=Issue%20on%20page%20%2FPython_notebooks/02_ols-and-lasso-for-wage-prediction.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/d2cml-ai/14.388_py/edit/master/_build/jupyter_execute/Python_notebooks/02_ols-and-lasso-for-wage-prediction.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/Python_notebooks/02_ols-and-lasso-for-wage-prediction.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   2.1. Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data">
   2.2. Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-analysis">
   2.3. Data analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prediction-question">
   2.4. Prediction Question
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#note-that-the-basic-model-consists-of-51-regressors">
     2.4.1. Note that the basic model consists of
     <span class="math notranslate nohighlight">
      \(51\)
     </span>
     regressors.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#try-lasso-next">
   2.5. Try Lasso next
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-splitting">
   2.6. Data Splitting
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>OLS and lasso for wage prediction</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   2.1. Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data">
   2.2. Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-analysis">
   2.3. Data analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prediction-question">
   2.4. Prediction Question
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#note-that-the-basic-model-consists-of-51-regressors">
     2.4.1. Note that the basic model consists of
     <span class="math notranslate nohighlight">
      \(51\)
     </span>
     regressors.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#try-lasso-next">
   2.5. Try Lasso next
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-splitting">
   2.6. Data Splitting
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="ols-and-lasso-for-wage-prediction">
<h1><span class="section-number">2. </span>OLS and lasso for wage prediction<a class="headerlink" href="#ols-and-lasso-for-wage-prediction" title="Permalink to this headline">#</a></h1>
<p>This notebook contains an example for teaching.</p>
<section id="introduction">
<h2><span class="section-number">2.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>In labor economics an important question is what determines the wage of workers. This is a causal question, but we could begin to investigate from a predictive perspective.</p>
<p>In the following wage example,  Y  is the hourly wage of a worker and  X  is a vector of worker’s characteristics, e.g., education, experience, gender. Two main questions here are:</p>
<ul class="simple">
<li><p>How to use job-relevant characteristics, such as education and experience, to best predict wages?</p></li>
<li><p>What is the difference in predicted wages between men and women with the same job-relevant characteristics?</p></li>
</ul>
<p>In this lab, we focus on the prediction question first.</p>
</section>
<section id="data">
<h2><span class="section-number">2.2. </span>Data<a class="headerlink" href="#data" title="Permalink to this headline">#</a></h2>
<p>The data set we consider is from the March Supplement of the U.S. Current Population Survey, year 2015. We select white non-hispanic individuals, aged 25 to 64 years, and working more than 35 hours per week during at least 50 weeks of the year. We exclude self-employed workers; individuals living in group quarters; individuals in the military, agricultural or private household sectors; individuals with inconsistent reports on earnings and employment status; individuals with allocated or missing information in any of the variables used in the analysis; and individuals with hourly wage below  3 .</p>
<p>The variable of interest  Y  is the hourly wage rate constructed as the ratio of the annual earnings to the total number of hours worked, which is constructed in turn as the product of number of weeks worked and the usual number of hours worked per week. In our analysis, we also focus on single (never married) workers. The final sample is of size  <strong>n=5150</strong> .</p>
</section>
<section id="data-analysis">
<h2><span class="section-number">2.3. </span>Data analysis<a class="headerlink" href="#data-analysis" title="Permalink to this headline">#</a></h2>
<p>We start by loading the data set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import relevant packages</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pyreadr</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rdata_read</span> <span class="o">=</span> <span class="n">pyreadr</span><span class="o">.</span><span class="n">read_r</span><span class="p">(</span><span class="s2">&quot;../data/wage2015_subsample_inference.Rdata&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">rdata_read</span><span class="p">[</span> <span class="s1">&#39;data&#39;</span> <span class="p">]</span>
<span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(5150, 20)
</pre></div>
</div>
</div>
</div>
<p>Let’s have a look at the structure of the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 5150 entries, 10 to 32643
Data columns (total 20 columns):
 #   Column  Non-Null Count  Dtype   
---  ------  --------------  -----   
 0   wage    5150 non-null   float64 
 1   lwage   5150 non-null   float64 
 2   sex     5150 non-null   float64 
 3   shs     5150 non-null   float64 
 4   hsg     5150 non-null   float64 
 5   scl     5150 non-null   float64 
 6   clg     5150 non-null   float64 
 7   ad      5150 non-null   float64 
 8   mw      5150 non-null   float64 
 9   so      5150 non-null   float64 
 10  we      5150 non-null   float64 
 11  ne      5150 non-null   float64 
 12  exp1    5150 non-null   float64 
 13  exp2    5150 non-null   float64 
 14  exp3    5150 non-null   float64 
 15  exp4    5150 non-null   float64 
 16  occ     5150 non-null   category
 17  occ2    5150 non-null   category
 18  ind     5150 non-null   category
 19  ind2    5150 non-null   category
dtypes: category(4), float64(16)
memory usage: 736.3+ KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wage</th>
      <th>lwage</th>
      <th>sex</th>
      <th>shs</th>
      <th>hsg</th>
      <th>scl</th>
      <th>clg</th>
      <th>ad</th>
      <th>mw</th>
      <th>so</th>
      <th>we</th>
      <th>ne</th>
      <th>exp1</th>
      <th>exp2</th>
      <th>exp3</th>
      <th>exp4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>5150.000000</td>
      <td>5150.000000</td>
      <td>5150.000000</td>
      <td>5150.000000</td>
      <td>5150.000000</td>
      <td>5150.000000</td>
      <td>5150.000000</td>
      <td>5150.000000</td>
      <td>5150.000000</td>
      <td>5150.000000</td>
      <td>5150.000000</td>
      <td>5150.000000</td>
      <td>5150.000000</td>
      <td>5150.000000</td>
      <td>5150.000000</td>
      <td>5150.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>23.410410</td>
      <td>2.970787</td>
      <td>0.444466</td>
      <td>0.023301</td>
      <td>0.243883</td>
      <td>0.278058</td>
      <td>0.317670</td>
      <td>0.137087</td>
      <td>0.259612</td>
      <td>0.296505</td>
      <td>0.216117</td>
      <td>0.227767</td>
      <td>13.760583</td>
      <td>3.018925</td>
      <td>8.235867</td>
      <td>25.118038</td>
    </tr>
    <tr>
      <th>std</th>
      <td>21.003016</td>
      <td>0.570385</td>
      <td>0.496955</td>
      <td>0.150872</td>
      <td>0.429465</td>
      <td>0.448086</td>
      <td>0.465616</td>
      <td>0.343973</td>
      <td>0.438464</td>
      <td>0.456761</td>
      <td>0.411635</td>
      <td>0.419432</td>
      <td>10.609465</td>
      <td>4.000904</td>
      <td>14.488962</td>
      <td>53.530225</td>
    </tr>
    <tr>
      <th>min</th>
      <td>3.021978</td>
      <td>1.105912</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>13.461538</td>
      <td>2.599837</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5.000000</td>
      <td>0.250000</td>
      <td>0.125000</td>
      <td>0.062500</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>19.230769</td>
      <td>2.956512</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>10.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>27.777778</td>
      <td>3.324236</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>21.000000</td>
      <td>4.410000</td>
      <td>9.261000</td>
      <td>19.448100</td>
    </tr>
    <tr>
      <th>max</th>
      <td>528.845673</td>
      <td>6.270697</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>47.000000</td>
      <td>22.090000</td>
      <td>103.823000</td>
      <td>487.968100</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We are constructing the output variable  <strong>Y</strong>  and the matrix  <strong>Z</strong>  which includes the characteristics of workers that are given in the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;wage&#39;</span><span class="p">])</span> 
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="o">~</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;wage&#39;</span><span class="p">,</span> <span class="s1">&#39;lwage&#39;</span><span class="p">,</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">])]</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of observation:&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Number of raw regressors:&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of observation: 5150 

Number of raw regressors: 18
</pre></div>
</div>
</div>
</div>
<p>For the outcome variable <em>wage</em> and a subset of the raw regressors, we calculate the empirical mean to get familiar with the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z_subset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;lwage&quot;</span><span class="p">,</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span><span class="s2">&quot;shs&quot;</span><span class="p">,</span><span class="s2">&quot;hsg&quot;</span><span class="p">,</span><span class="s2">&quot;scl&quot;</span><span class="p">,</span><span class="s2">&quot;clg&quot;</span><span class="p">,</span><span class="s2">&quot;ad&quot;</span><span class="p">,</span><span class="s2">&quot;mw&quot;</span><span class="p">,</span><span class="s2">&quot;so&quot;</span><span class="p">,</span><span class="s2">&quot;we&quot;</span><span class="p">,</span><span class="s2">&quot;ne&quot;</span><span class="p">,</span><span class="s2">&quot;exp1&quot;</span><span class="p">])]</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">Z_subset</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>lwage     2.970787
sex       0.444466
shs       0.023301
hsg       0.243883
scl       0.278058
clg       0.317670
ad        0.137087
mw        0.259612
so        0.296505
we        0.216117
ne        0.227767
exp1     13.760583
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">table</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Sample mean&quot;</span><span class="p">:</span><span class="s2">&quot;0&quot;</span><span class="p">}</span> <span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">index</span>
<span class="n">index1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">index2</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Log Wage&quot;</span><span class="p">,</span><span class="s2">&quot;Sex&quot;</span><span class="p">,</span><span class="s2">&quot;Some High School&quot;</span><span class="p">,</span><span class="s2">&quot;High School Graduate&quot;</span><span class="p">,</span>\
          <span class="s2">&quot;Some College&quot;</span><span class="p">,</span><span class="s2">&quot;College Graduate&quot;</span><span class="p">,</span> <span class="s2">&quot;Advanced Degree&quot;</span><span class="p">,</span><span class="s2">&quot;Midwest&quot;</span><span class="p">,</span>\
          <span class="s2">&quot;South&quot;</span><span class="p">,</span><span class="s2">&quot;West&quot;</span><span class="p">,</span><span class="s2">&quot;Northeast&quot;</span><span class="p">,</span><span class="s2">&quot;Experience&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">index1</span><span class="p">,</span><span class="n">index2</span><span class="p">)))</span>
<span class="n">table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Sample mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Log Wage</th>
      <td>2.970787</td>
    </tr>
    <tr>
      <th>Sex</th>
      <td>0.444466</td>
    </tr>
    <tr>
      <th>Some High School</th>
      <td>0.023301</td>
    </tr>
    <tr>
      <th>High School Graduate</th>
      <td>0.243883</td>
    </tr>
    <tr>
      <th>Some College</th>
      <td>0.278058</td>
    </tr>
    <tr>
      <th>College Graduate</th>
      <td>0.317670</td>
    </tr>
    <tr>
      <th>Advanced Degree</th>
      <td>0.137087</td>
    </tr>
    <tr>
      <th>Midwest</th>
      <td>0.259612</td>
    </tr>
    <tr>
      <th>South</th>
      <td>0.296505</td>
    </tr>
    <tr>
      <th>West</th>
      <td>0.216117</td>
    </tr>
    <tr>
      <th>Northeast</th>
      <td>0.227767</td>
    </tr>
    <tr>
      <th>Experience</th>
      <td>13.760583</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>E.g., the share of female workers in our sample is ~44% (<span class="math notranslate nohighlight">\(sex=1\)</span> if female).</p>
<p>Alternatively, we can also print the table as latex.</p>
</section>
<section id="prediction-question">
<h2><span class="section-number">2.4. </span>Prediction Question<a class="headerlink" href="#prediction-question" title="Permalink to this headline">#</a></h2>
<p>Now, we will construct a prediction rule for hourly wage <span class="math notranslate nohighlight">\(Y\)</span>, which depends linearly on job-relevant characteristics <span class="math notranslate nohighlight">\(X\)</span>:</p>
<p>\begin{equation}\label{decompose}
Y = \beta’X+ \epsilon.
\end{equation}</p>
<p>Our goals are</p>
<ul class="simple">
<li><p>Predict wages  using various characteristics of workers.</p></li>
<li><p>Assess the predictive performance using the (adjusted) sample MSE, the (adjusted) sample <span class="math notranslate nohighlight">\(R^2\)</span> and the out-of-sample MSE and <span class="math notranslate nohighlight">\(R^2\)</span>.</p></li>
</ul>
<p>We employ two different specifications for prediction:</p>
<ol class="simple">
<li><p>Basic Model:   <span class="math notranslate nohighlight">\(X\)</span> consists of a set of raw regressors (e.g. gender, experience, education indicators,  occupation and industry indicators, regional indicators).</p></li>
<li><p>Flexible Model:  <span class="math notranslate nohighlight">\(X\)</span> consists of all raw regressors from the basic model plus occupation and industry indicators, transformations (e.g., <span class="math notranslate nohighlight">\({exp}^2\)</span> and <span class="math notranslate nohighlight">\({exp}^3\)</span>) and additional two-way interactions of polynomial in experience with other regressors. An example of a regressor created through a two-way interaction is <em>experience</em> times the indicator of having a <em>college degree</em>.</p></li>
</ol>
<p>Using the <strong>Flexible Model</strong>, enables us to approximate the real relationship by a
more complex regression model and therefore to reduce the bias. The <strong>Flexible Model</strong> increases the range of potential shapes of the estimated regression function. In general, flexible models often deliver good prediction accuracy but give models which are harder to interpret.</p>
<p>Now, let us fit both models to our data by running ordinary least squares (ols):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import packages for OLS regression</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>

<span class="c1"># 1. basic model</span>
<span class="n">basic</span> <span class="o">=</span> <span class="s1">&#39;lwage ~ sex + exp1 + shs + hsg+ scl + clg + mw + so + we + occ2+ ind2&#39;</span>
<span class="n">basic_results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">basic</span> <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">basic_results</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span> <span class="c1"># estimated coefficients</span>
<span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Number of regressors in the basic model:&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">basic_results</span><span class="o">.</span><span class="n">params</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># number of regressors in the Basic Model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                  lwage   R-squared:                       0.310
Model:                            OLS   Adj. R-squared:                  0.303
Method:                 Least Squares   F-statistic:                     45.83
Date:                Sat, 23 Jul 2022   Prob (F-statistic):               0.00
Time:                        14:05:26   Log-Likelihood:                -3459.9
No. Observations:                5150   AIC:                             7022.
Df Residuals:                    5099   BIC:                             7356.
Df Model:                          50                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      3.5284      0.054     65.317      0.000       3.422       3.634
occ2[T.10]    -0.0106      0.040     -0.268      0.789      -0.088       0.067
occ2[T.11]    -0.4558      0.059     -7.669      0.000      -0.572      -0.339
occ2[T.12]    -0.3076      0.056     -5.541      0.000      -0.416      -0.199
occ2[T.13]    -0.3614      0.046     -7.937      0.000      -0.451      -0.272
occ2[T.14]    -0.4995      0.051     -9.867      0.000      -0.599      -0.400
occ2[T.15]    -0.4645      0.052     -8.973      0.000      -0.566      -0.363
occ2[T.16]    -0.2337      0.032     -7.206      0.000      -0.297      -0.170
occ2[T.17]    -0.4126      0.028    -14.784      0.000      -0.467      -0.358
occ2[T.18]    -0.3404      0.197     -1.731      0.083      -0.726       0.045
occ2[T.19]    -0.2415      0.049     -4.880      0.000      -0.338      -0.144
occ2[T.2]     -0.0765      0.034     -2.236      0.025      -0.144      -0.009
occ2[T.20]    -0.2126      0.041     -5.201      0.000      -0.293      -0.132
occ2[T.21]    -0.2884      0.038     -7.573      0.000      -0.363      -0.214
occ2[T.22]    -0.4224      0.041    -10.187      0.000      -0.504      -0.341
occ2[T.3]     -0.0347      0.039     -0.895      0.371      -0.111       0.041
occ2[T.4]     -0.0962      0.052     -1.853      0.064      -0.198       0.006
occ2[T.5]     -0.1879      0.060     -3.111      0.002      -0.306      -0.070
occ2[T.6]     -0.4149      0.050     -8.263      0.000      -0.513      -0.316
occ2[T.7]     -0.0460      0.057     -0.814      0.416      -0.157       0.065
occ2[T.8]     -0.3778      0.044     -8.601      0.000      -0.464      -0.292
occ2[T.9]     -0.2158      0.046     -4.678      0.000      -0.306      -0.125
ind2[T.11]     0.0248      0.058      0.427      0.669      -0.089       0.139
ind2[T.12]     0.1164      0.053      2.201      0.028       0.013       0.220
ind2[T.13]     0.0212      0.068      0.312      0.755      -0.112       0.155
ind2[T.14]     0.0068      0.050      0.136      0.892      -0.092       0.106
ind2[T.15]    -0.1315      0.137     -0.959      0.338      -0.400       0.137
ind2[T.16]    -0.1215      0.056     -2.177      0.029      -0.231      -0.012
ind2[T.17]    -0.1106      0.056     -1.987      0.047      -0.220      -0.001
ind2[T.18]    -0.1415      0.051     -2.774      0.006      -0.242      -0.042
ind2[T.19]    -0.1803      0.065     -2.761      0.006      -0.308      -0.052
ind2[T.2]      0.1939      0.084      2.301      0.021       0.029       0.359
ind2[T.20]    -0.3581      0.057     -6.332      0.000      -0.469      -0.247
ind2[T.21]    -0.1228      0.055     -2.239      0.025      -0.230      -0.015
ind2[T.22]     0.0749      0.053      1.407      0.160      -0.029       0.179
ind2[T.3]      0.0770      0.079      0.972      0.331      -0.078       0.232
ind2[T.4]     -0.0506      0.058     -0.874      0.382      -0.164       0.063
ind2[T.5]     -0.0797      0.056     -1.432      0.152      -0.189       0.029
ind2[T.6]     -0.0555      0.052     -1.072      0.284      -0.157       0.046
ind2[T.7]      0.0543      0.072      0.756      0.450      -0.086       0.195
ind2[T.8]     -0.0491      0.072     -0.679      0.497      -0.191       0.093
ind2[T.9]     -0.1936      0.048     -4.017      0.000      -0.288      -0.099
sex           -0.0729      0.015     -4.848      0.000      -0.102      -0.043
exp1           0.0086      0.001     13.106      0.000       0.007       0.010
shs           -0.5928      0.051    -11.726      0.000      -0.692      -0.494
hsg           -0.5043      0.027    -18.626      0.000      -0.557      -0.451
scl           -0.4120      0.025    -16.347      0.000      -0.461      -0.363
clg           -0.1822      0.023     -7.939      0.000      -0.227      -0.137
mw            -0.0275      0.019     -1.425      0.154      -0.065       0.010
so            -0.0345      0.019     -1.842      0.066      -0.071       0.002
we             0.0172      0.020      0.859      0.391      -0.022       0.057
==============================================================================
Omnibus:                      437.645   Durbin-Watson:                   1.885
Prob(Omnibus):                  0.000   Jarque-Bera (JB):             1862.313
Skew:                           0.322   Prob(JB):                         0.00
Kurtosis:                       5.875   Cond. No.                         541.
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
Number of regressors in the basic model: 51 
</pre></div>
</div>
</div>
</div>
<section id="note-that-the-basic-model-consists-of-51-regressors">
<h3><span class="section-number">2.4.1. </span>Note that the basic model consists of <span class="math notranslate nohighlight">\(51\)</span> regressors.<a class="headerlink" href="#note-that-the-basic-model-consists-of-51-regressors" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2. flexible model</span>
<span class="n">flex</span> <span class="o">=</span> <span class="s1">&#39;lwage ~ sex + shs+hsg+scl+clg+occ2+ind2+mw+so+we + (exp1+exp2+exp3+exp4)*(shs+hsg+scl+clg+occ2+ind2+mw+so+we)&#39;</span>
<span class="n">flex_results_0</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">flex</span> <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="n">flex_results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">flex</span> <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flex_results</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span> <span class="c1"># estimated coefficients</span>
<span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Number of regressors in the basic model:&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">flex_results</span><span class="o">.</span><span class="n">params</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># number of regressors in the Flexible Model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                  lwage   R-squared:                       0.351
Model:                            OLS   Adj. R-squared:                  0.319
Method:                 Least Squares   F-statistic:                     10.83
Date:                Sat, 23 Jul 2022   Prob (F-statistic):          2.69e-305
Time:                        14:05:27   Log-Likelihood:                -3301.9
No. Observations:                5150   AIC:                             7096.
Df Residuals:                    4904   BIC:                             8706.
Df Model:                         245                                         
Covariance Type:            nonrobust                                         
===================================================================================
                      coef    std err          t      P&gt;|t|      [0.025      0.975]
-----------------------------------------------------------------------------------
Intercept           3.2797      0.284     11.540      0.000       2.723       3.837
occ2[T.10]          0.0210      0.156      0.134      0.893      -0.286       0.328
occ2[T.11]         -0.6424      0.309     -2.078      0.038      -1.248      -0.036
occ2[T.12]         -0.0675      0.252     -0.268      0.789      -0.562       0.427
occ2[T.13]         -0.2330      0.232     -1.006      0.314      -0.687       0.221
occ2[T.14]          0.2562      0.323      0.794      0.427      -0.376       0.889
occ2[T.15]         -0.1939      0.260     -0.747      0.455      -0.703       0.315
occ2[T.16]         -0.0551      0.147     -0.375      0.708      -0.343       0.233
occ2[T.17]         -0.4156      0.136     -3.053      0.002      -0.682      -0.149
occ2[T.18]         -0.4822      1.044     -0.462      0.644      -2.530       1.565
occ2[T.19]         -0.2579      0.333     -0.776      0.438      -0.910       0.394
occ2[T.2]           0.1613      0.130      1.244      0.214      -0.093       0.416
occ2[T.20]         -0.3010      0.234     -1.286      0.199      -0.760       0.158
occ2[T.21]         -0.4272      0.221     -1.936      0.053      -0.860       0.005
occ2[T.22]         -0.8695      0.298     -2.922      0.003      -1.453      -0.286
occ2[T.3]           0.2102      0.169      1.246      0.213      -0.121       0.541
occ2[T.4]           0.0709      0.184      0.386      0.700      -0.289       0.431
occ2[T.5]          -0.3960      0.189     -2.100      0.036      -0.766      -0.026
occ2[T.6]          -0.2311      0.187     -1.236      0.217      -0.598       0.135
occ2[T.7]           0.3147      0.194      1.621      0.105      -0.066       0.695
occ2[T.8]          -0.1875      0.169     -1.108      0.268      -0.519       0.144
occ2[T.9]          -0.3390      0.167     -2.027      0.043      -0.667      -0.011
ind2[T.11]         -0.4047      0.314     -1.288      0.198      -1.021       0.211
ind2[T.12]         -0.1570      0.279     -0.562      0.574      -0.705       0.391
ind2[T.13]         -0.4377      0.362     -1.210      0.226      -1.147       0.271
ind2[T.14]         -0.0054      0.270     -0.020      0.984      -0.535       0.524
ind2[T.15]          0.2004      0.501      0.400      0.689      -0.781       1.182
ind2[T.16]          0.0102      0.300      0.034      0.973      -0.577       0.598
ind2[T.17]         -0.2396      0.285     -0.841      0.401      -0.798       0.319
ind2[T.18]         -0.1808      0.278     -0.649      0.516      -0.727       0.365
ind2[T.19]         -0.3007      0.327     -0.921      0.357      -0.941       0.339
ind2[T.2]           0.5806      0.481      1.207      0.227      -0.362       1.523
ind2[T.20]         -0.3293      0.313     -1.052      0.293      -0.943       0.284
ind2[T.21]         -0.1781      0.304     -0.586      0.558      -0.773       0.417
ind2[T.22]          0.1765      0.296      0.596      0.551      -0.404       0.757
ind2[T.3]          -0.6668      0.561     -1.189      0.234      -1.766       0.433
ind2[T.4]           0.4858      0.350      1.389      0.165      -0.200       1.171
ind2[T.5]           0.0512      0.298      0.172      0.863      -0.532       0.635
ind2[T.6]          -0.0416      0.299     -0.139      0.889      -0.628       0.545
ind2[T.7]           0.0758      0.387      0.196      0.845      -0.683       0.835
ind2[T.8]          -0.1490      0.337     -0.441      0.659      -0.811       0.513
ind2[T.9]          -0.2219      0.275     -0.808      0.419      -0.760       0.316
sex                -0.0696      0.015     -4.570      0.000      -0.099      -0.040
shs                -0.1233      0.907     -0.136      0.892      -1.901       1.654
hsg                -0.5289      0.198     -2.675      0.008      -0.917      -0.141
scl                -0.2921      0.126     -2.318      0.021      -0.539      -0.045
clg                -0.0412      0.070     -0.585      0.559      -0.179       0.097
mw                  0.1107      0.081      1.359      0.174      -0.049       0.270
so                  0.0224      0.074      0.301      0.763      -0.123       0.168
we                 -0.0216      0.084     -0.256      0.798      -0.187       0.143
exp1                0.0835      0.094      0.884      0.377      -0.102       0.269
exp1:occ2[T.10]     0.0076      0.058      0.130      0.897      -0.106       0.122
exp1:occ2[T.11]     0.1014      0.101      1.009      0.313      -0.096       0.298
exp1:occ2[T.12]    -0.0863      0.087     -0.986      0.324      -0.258       0.085
exp1:occ2[T.13]     0.0067      0.076      0.088      0.930      -0.143       0.156
exp1:occ2[T.14]    -0.1369      0.097     -1.405      0.160      -0.328       0.054
exp1:occ2[T.15]    -0.0400      0.090     -0.445      0.656      -0.216       0.136
exp1:occ2[T.16]    -0.0539      0.052     -1.035      0.301      -0.156       0.048
exp1:occ2[T.17]     0.0147      0.047      0.315      0.753      -0.077       0.106
exp1:occ2[T.18]     0.1074      0.472      0.228      0.820      -0.818       1.032
exp1:occ2[T.19]     0.0047      0.106      0.044      0.965      -0.203       0.213
exp1:occ2[T.2]     -0.0736      0.050     -1.469      0.142      -0.172       0.025
exp1:occ2[T.20]     0.0243      0.074      0.327      0.744      -0.121       0.170
exp1:occ2[T.21]     0.0792      0.070      1.136      0.256      -0.057       0.216
exp1:occ2[T.22]     0.1093      0.088      1.241      0.215      -0.063       0.282
exp1:occ2[T.3]     -0.0715      0.064     -1.121      0.262      -0.197       0.054
exp1:occ2[T.4]     -0.0724      0.075     -0.968      0.333      -0.219       0.074
exp1:occ2[T.5]      0.0947      0.079      1.192      0.233      -0.061       0.250
exp1:occ2[T.6]     -0.0349      0.071     -0.490      0.624      -0.175       0.105
exp1:occ2[T.7]     -0.2279      0.078     -2.904      0.004      -0.382      -0.074
exp1:occ2[T.8]     -0.0727      0.065     -1.126      0.260      -0.199       0.054
exp1:occ2[T.9]      0.0274      0.067      0.409      0.682      -0.104       0.159
exp1:ind2[T.11]     0.1662      0.106      1.570      0.116      -0.041       0.374
exp1:ind2[T.12]     0.1079      0.093      1.156      0.248      -0.075       0.291
exp1:ind2[T.13]     0.1884      0.117      1.605      0.109      -0.042       0.418
exp1:ind2[T.14]    -0.0071      0.089     -0.080      0.936      -0.182       0.168
exp1:ind2[T.15]    -0.2081      0.203     -1.024      0.306      -0.607       0.190
exp1:ind2[T.16]    -0.0665      0.099     -0.671      0.502      -0.261       0.128
exp1:ind2[T.17]     0.0216      0.095      0.229      0.819      -0.164       0.207
exp1:ind2[T.18]     0.0053      0.091      0.058      0.954      -0.172       0.183
exp1:ind2[T.19]     0.0004      0.111      0.003      0.997      -0.217       0.217
exp1:ind2[T.2]     -0.1513      0.164     -0.920      0.358      -0.474       0.171
exp1:ind2[T.20]    -0.0186      0.102     -0.182      0.855      -0.219       0.182
exp1:ind2[T.21]     0.0678      0.101      0.673      0.501      -0.130       0.265
exp1:ind2[T.22]    -0.0367      0.096     -0.380      0.704      -0.226       0.152
exp1:ind2[T.3]      0.3246      0.188      1.722      0.085      -0.045       0.694
exp1:ind2[T.4]     -0.1365      0.114     -1.194      0.233      -0.361       0.088
exp1:ind2[T.5]     -0.0256      0.096     -0.265      0.791      -0.215       0.163
exp1:ind2[T.6]      0.0028      0.096      0.029      0.977      -0.185       0.191
exp1:ind2[T.7]     -0.0483      0.133     -0.364      0.716      -0.309       0.212
exp1:ind2[T.8]      0.0845      0.118      0.715      0.475      -0.147       0.316
exp1:ind2[T.9]     -0.0153      0.087     -0.176      0.860      -0.186       0.156
exp2               -0.5610      0.949     -0.591      0.554      -2.421       1.299
exp2:occ2[T.10]    -0.2692      0.641     -0.420      0.674      -1.525       0.986
exp2:occ2[T.11]    -1.0817      1.006     -1.075      0.282      -3.053       0.890
exp2:occ2[T.12]     0.8324      0.934      0.891      0.373      -0.999       2.664
exp2:occ2[T.13]    -0.2210      0.773     -0.286      0.775      -1.736       1.294
exp2:occ2[T.14]     0.7511      0.927      0.810      0.418      -1.067       2.569
exp2:occ2[T.15]    -0.0327      0.941     -0.035      0.972      -1.877       1.812
exp2:occ2[T.16]     0.3636      0.551      0.660      0.509      -0.717       1.444
exp2:occ2[T.17]    -0.2659      0.486     -0.547      0.584      -1.219       0.687
exp2:occ2[T.18]    -2.5609      5.170     -0.495      0.620     -12.697       7.575
exp2:occ2[T.19]    -0.1292      1.062     -0.122      0.903      -2.211       1.952
exp2:occ2[T.2]      0.6632      0.552      1.201      0.230      -0.420       1.746
exp2:occ2[T.20]    -0.3323      0.723     -0.460      0.646      -1.750       1.085
exp2:occ2[T.21]    -0.9100      0.685     -1.328      0.184      -2.254       0.434
exp2:occ2[T.22]    -0.8551      0.828     -1.033      0.302      -2.478       0.768
exp2:occ2[T.3]      0.6415      0.710      0.903      0.366      -0.751       2.034
exp2:occ2[T.4]      0.9748      0.866      1.126      0.260      -0.722       2.672
exp2:occ2[T.5]     -0.9779      0.974     -1.004      0.315      -2.887       0.931
exp2:occ2[T.6]      0.1051      0.800      0.131      0.896      -1.464       1.674
exp2:occ2[T.7]      3.1407      0.939      3.345      0.001       1.300       4.981
exp2:occ2[T.8]      0.6711      0.719      0.933      0.351      -0.739       2.081
exp2:occ2[T.9]      0.0232      0.763      0.030      0.976      -1.472       1.519
exp2:ind2[T.11]    -1.6804      1.080     -1.555      0.120      -3.798       0.438
exp2:ind2[T.12]    -0.9717      0.935     -1.039      0.299      -2.804       0.861
exp2:ind2[T.13]    -1.7679      1.156     -1.529      0.126      -4.035       0.499
exp2:ind2[T.14]     0.1190      0.888      0.134      0.893      -1.622       1.860
exp2:ind2[T.15]     2.3885      2.202      1.085      0.278      -1.928       6.705
exp2:ind2[T.16]     0.8707      0.990      0.879      0.379      -1.070       2.812
exp2:ind2[T.17]    -0.0030      0.948     -0.003      0.998      -1.862       1.856
exp2:ind2[T.18]    -0.0033      0.889     -0.004      0.997      -1.746       1.740
exp2:ind2[T.19]     0.2665      1.119      0.238      0.812      -1.927       2.460
exp2:ind2[T.2]      2.1973      1.774      1.239      0.216      -1.280       5.675
exp2:ind2[T.20]     0.2506      1.010      0.248      0.804      -1.729       2.231
exp2:ind2[T.21]    -0.9154      1.015     -0.902      0.367      -2.904       1.074
exp2:ind2[T.22]     0.3395      0.949      0.358      0.721      -1.522       2.201
exp2:ind2[T.3]     -3.7396      1.959     -1.908      0.056      -7.581       0.102
exp2:ind2[T.4]      1.0920      1.143      0.955      0.339      -1.149       3.333
exp2:ind2[T.5]      0.1824      0.939      0.194      0.846      -1.658       2.023
exp2:ind2[T.6]     -0.0304      0.930     -0.033      0.974      -1.853       1.792
exp2:ind2[T.7]      0.7325      1.440      0.509      0.611      -2.090       3.555
exp2:ind2[T.8]     -0.7507      1.203     -0.624      0.533      -3.108       1.607
exp2:ind2[T.9]      0.4177      0.839      0.498      0.619      -1.227       2.062
exp3                0.1293      0.357      0.363      0.717      -0.570       0.828
exp3:occ2[T.10]     0.1855      0.258      0.720      0.471      -0.319       0.690
exp3:occ2[T.11]     0.3932      0.382      1.030      0.303      -0.355       1.142
exp3:occ2[T.12]    -0.2203      0.366     -0.602      0.547      -0.938       0.497
exp3:occ2[T.13]     0.0950      0.290      0.327      0.744      -0.474       0.664
exp3:occ2[T.14]    -0.1444      0.334     -0.432      0.666      -0.800       0.511
exp3:occ2[T.15]     0.1477      0.365      0.405      0.685      -0.567       0.862
exp3:occ2[T.16]    -0.0379      0.215     -0.176      0.860      -0.460       0.384
exp3:occ2[T.17]     0.1510      0.188      0.804      0.421      -0.217       0.519
exp3:occ2[T.18]     1.4084      1.885      0.747      0.455      -2.287       5.104
exp3:occ2[T.19]     0.0923      0.404      0.228      0.819      -0.700       0.885
exp3:occ2[T.2]     -0.2039      0.221     -0.922      0.356      -0.637       0.230
exp3:occ2[T.20]     0.1807      0.265      0.681      0.496      -0.339       0.701
exp3:occ2[T.21]     0.3779      0.255      1.480      0.139      -0.123       0.878
exp3:occ2[T.22]     0.2855      0.298      0.957      0.339      -0.300       0.871
exp3:occ2[T.3]     -0.2370      0.287     -0.826      0.409      -0.800       0.326
exp3:occ2[T.4]     -0.4367      0.352     -1.241      0.215      -1.127       0.253
exp3:occ2[T.5]      0.3885      0.412      0.943      0.346      -0.419       1.196
exp3:occ2[T.6]      0.0485      0.329      0.147      0.883      -0.597       0.694
exp3:occ2[T.7]     -1.3949      0.405     -3.444      0.001      -2.189      -0.601
exp3:occ2[T.8]     -0.2054      0.290     -0.709      0.478      -0.773       0.362
exp3:occ2[T.9]     -0.0910      0.314     -0.289      0.772      -0.707       0.525
exp3:ind2[T.11]     0.6429      0.411      1.564      0.118      -0.163       1.449
exp3:ind2[T.12]     0.3286      0.347      0.947      0.344      -0.351       1.009
exp3:ind2[T.13]     0.5929      0.426      1.392      0.164      -0.242       1.428
exp3:ind2[T.14]    -0.0285      0.328     -0.087      0.931      -0.672       0.615
exp3:ind2[T.15]    -0.8569      0.844     -1.016      0.310      -2.511       0.797
exp3:ind2[T.16]    -0.3558      0.368     -0.968      0.333      -1.077       0.365
exp3:ind2[T.17]    -0.0363      0.352     -0.103      0.918      -0.727       0.654
exp3:ind2[T.18]     0.0157      0.325      0.048      0.961      -0.621       0.653
exp3:ind2[T.19]    -0.1488      0.421     -0.354      0.724      -0.974       0.676
exp3:ind2[T.2]     -1.0448      0.707     -1.479      0.139      -2.430       0.341
exp3:ind2[T.20]    -0.0679      0.370     -0.183      0.855      -0.794       0.658
exp3:ind2[T.21]     0.3967      0.381      1.041      0.298      -0.351       1.144
exp3:ind2[T.22]    -0.0760      0.349     -0.218      0.827      -0.760       0.608
exp3:ind2[T.3]      1.6218      0.785      2.067      0.039       0.084       3.160
exp3:ind2[T.4]     -0.3150      0.429     -0.735      0.463      -1.155       0.526
exp3:ind2[T.5]     -0.0506      0.340     -0.149      0.882      -0.717       0.616
exp3:ind2[T.6]      0.0193      0.336      0.058      0.954      -0.639       0.678
exp3:ind2[T.7]     -0.3359      0.586     -0.573      0.567      -1.485       0.813
exp3:ind2[T.8]      0.1893      0.452      0.419      0.675      -0.696       1.075
exp3:ind2[T.9]     -0.2161      0.300     -0.721      0.471      -0.804       0.372
exp4               -0.0053      0.045     -0.120      0.904      -0.093       0.082
exp4:occ2[T.10]    -0.0333      0.034     -0.984      0.325      -0.100       0.033
exp4:occ2[T.11]    -0.0466      0.048     -0.973      0.331      -0.141       0.047
exp4:occ2[T.12]     0.0110      0.047      0.234      0.815      -0.081       0.103
exp4:occ2[T.13]    -0.0137      0.036     -0.381      0.703      -0.084       0.057
exp4:occ2[T.14]     0.0056      0.040      0.139      0.890      -0.073       0.084
exp4:occ2[T.15]    -0.0327      0.046     -0.708      0.479      -0.123       0.058
exp4:occ2[T.16]    -0.0090      0.028     -0.325      0.745      -0.063       0.045
exp4:occ2[T.17]    -0.0257      0.024     -1.073      0.283      -0.073       0.021
exp4:occ2[T.18]    -0.2121      0.220     -0.963      0.336      -0.644       0.220
exp4:occ2[T.19]    -0.0169      0.051     -0.330      0.741      -0.118       0.084
exp4:occ2[T.2]      0.0176      0.029      0.610      0.542      -0.039       0.074
exp4:occ2[T.20]    -0.0296      0.032     -0.916      0.360      -0.093       0.034
exp4:occ2[T.21]    -0.0525      0.032     -1.654      0.098      -0.115       0.010
exp4:occ2[T.22]    -0.0351      0.036     -0.972      0.331      -0.106       0.036
exp4:occ2[T.3]      0.0303      0.038      0.805      0.421      -0.044       0.104
exp4:occ2[T.4]      0.0584      0.046      1.276      0.202      -0.031       0.148
exp4:occ2[T.5]     -0.0515      0.055     -0.938      0.349      -0.159       0.056
exp4:occ2[T.6]     -0.0170      0.044     -0.386      0.699      -0.103       0.069
exp4:occ2[T.7]      0.1905      0.056      3.410      0.001       0.081       0.300
exp4:occ2[T.8]      0.0197      0.038      0.518      0.604      -0.055       0.094
exp4:occ2[T.9]      0.0190      0.042      0.451      0.652      -0.064       0.102
exp4:ind2[T.11]    -0.0840      0.052     -1.619      0.106      -0.186       0.018
exp4:ind2[T.12]    -0.0390      0.042     -0.918      0.359      -0.122       0.044
exp4:ind2[T.13]    -0.0673      0.052     -1.297      0.195      -0.169       0.034
exp4:ind2[T.14] -6.822e-05      0.040     -0.002      0.999      -0.079       0.078
exp4:ind2[T.15]     0.0951      0.104      0.911      0.362      -0.110       0.300
exp4:ind2[T.16]     0.0439      0.045      0.970      0.332      -0.045       0.132
exp4:ind2[T.17]     0.0055      0.043      0.129      0.898      -0.079       0.090
exp4:ind2[T.18]    -0.0063      0.039     -0.161      0.872      -0.084       0.071
exp4:ind2[T.19]     0.0213      0.052      0.407      0.684      -0.081       0.124
exp4:ind2[T.2]      0.1483      0.092      1.615      0.106      -0.032       0.328
exp4:ind2[T.20]     0.0014      0.045      0.032      0.975      -0.087       0.089
exp4:ind2[T.21]    -0.0550      0.047     -1.160      0.246      -0.148       0.038
exp4:ind2[T.22]     0.0002      0.042      0.004      0.996      -0.083       0.083
exp4:ind2[T.3]     -0.2369      0.107     -2.220      0.026      -0.446      -0.028
exp4:ind2[T.4]      0.0273      0.053      0.511      0.609      -0.077       0.132
exp4:ind2[T.5]      0.0042      0.041      0.103      0.918      -0.076       0.084
exp4:ind2[T.6]     -0.0043      0.040     -0.108      0.914      -0.083       0.075
exp4:ind2[T.7]      0.0481      0.078      0.613      0.540      -0.106       0.202
exp4:ind2[T.8]     -0.0127      0.056     -0.226      0.821      -0.123       0.097
exp4:ind2[T.9]      0.0305      0.035      0.861      0.389      -0.039       0.100
exp1:shs           -0.1920      0.196     -0.982      0.326      -0.575       0.191
exp1:hsg           -0.0173      0.057     -0.303      0.762      -0.130       0.095
exp1:scl           -0.0665      0.043     -1.532      0.126      -0.151       0.019
exp1:clg           -0.0550      0.031     -1.774      0.076      -0.116       0.006
exp1:mw            -0.0280      0.030     -0.944      0.345      -0.086       0.030
exp1:so            -0.0100      0.027     -0.374      0.709      -0.062       0.042
exp1:we             0.0063      0.030      0.209      0.834      -0.053       0.065
exp2:shs            1.9005      1.450      1.310      0.190      -0.943       4.744
exp2:hsg            0.1172      0.551      0.213      0.832      -0.963       1.197
exp2:scl            0.6218      0.463      1.343      0.179      -0.286       1.529
exp2:clg            0.4097      0.380      1.077      0.281      -0.336       1.155
exp2:mw             0.2006      0.317      0.632      0.527      -0.421       0.823
exp2:so             0.0544      0.282      0.193      0.847      -0.498       0.606
exp2:we             0.0013      0.321      0.004      0.997      -0.628       0.630
exp3:shs           -0.6721      0.443     -1.518      0.129      -1.540       0.196
exp3:hsg           -0.0180      0.208     -0.086      0.931      -0.426       0.390
exp3:scl           -0.1998      0.186     -1.077      0.282      -0.563       0.164
exp3:clg           -0.1025      0.164     -0.624      0.533      -0.425       0.220
exp3:mw            -0.0626      0.124     -0.504      0.614      -0.306       0.181
exp3:so            -0.0116      0.108     -0.107      0.915      -0.224       0.201
exp3:we            -0.0125      0.125     -0.100      0.921      -0.258       0.233
exp4:shs            0.0777      0.048      1.635      0.102      -0.015       0.171
exp4:hsg            0.0005      0.027      0.018      0.985      -0.052       0.053
exp4:scl            0.0211      0.025      0.859      0.390      -0.027       0.069
exp4:clg            0.0079      0.023      0.346      0.729      -0.037       0.052
exp4:mw             0.0062      0.016      0.393      0.694      -0.025       0.037
exp4:so             0.0003      0.014      0.023      0.982      -0.026       0.027
exp4:we             0.0018      0.016      0.111      0.912      -0.030       0.033
==============================================================================
Omnibus:                      395.012   Durbin-Watson:                   1.898
Prob(Omnibus):                  0.000   Jarque-Bera (JB):             1529.250
Skew:                           0.303   Prob(JB):                         0.00
Kurtosis:                       5.600   Cond. No.                     6.87e+04
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 6.87e+04. This might indicate that there are
strong multicollinearity or other numerical problems.
Number of regressors in the basic model: 246 
</pre></div>
</div>
</div>
</div>
<p>Note that the flexible model consists of <span class="math notranslate nohighlight">\(246\)</span> regressors.</p>
</section>
</section>
<section id="try-lasso-next">
<h2><span class="section-number">2.5. </span>Try Lasso next<a class="headerlink" href="#try-lasso-next" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import relevant packages for lasso </span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LassoCV</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get exogenous variables from flexible model</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">flex_results_0</span><span class="o">.</span><span class="n">exog</span>
<span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(5150, 246)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set endogenous variable</span>
<span class="n">lwage</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;lwage&quot;</span><span class="p">]</span>
<span class="n">lwage</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(5150,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set penalty value = 0.1</span>
<span class="c1">#reg = linear_model.Lasso(alpha=0.1/np.log(len(lwage)))</span>
<span class="n">reg</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">)</span>

<span class="c1"># LASSO regression for flexible model</span>
<span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">lwage</span><span class="p">)</span>
<span class="n">lwage_lasso_fitted</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">lwage</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">X</span> <span class="p">)</span>

<span class="c1"># coefficients </span>
<span class="n">reg</span><span class="o">.</span><span class="n">coef_</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lasso Regression: R^2 score&#39;</span><span class="p">,</span> <span class="n">reg</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">lwage</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lasso Regression: R^2 score 0.1604784962552065
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check predicted values</span>
<span class="n">lwage_lasso_fitted</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3.03889357, 3.27908164, 2.82185985, ..., 3.07156184, 2.85967102,
       3.21586563])
</pre></div>
</div>
</div>
</div>
<p>Now, we can evaluate the performance of both models based on the (adjusted) <span class="math notranslate nohighlight">\(R^2_{sample}\)</span> and the (adjusted) <span class="math notranslate nohighlight">\(MSE_{sample}\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic Model</span>
<span class="n">basic</span> <span class="o">=</span> <span class="s1">&#39;lwage ~ sex + exp1 + shs + hsg+ scl + clg + mw + so + we + occ2+ ind2&#39;</span>
<span class="n">basic_results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">basic</span> <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Flexible model </span>
<span class="n">flex</span> <span class="o">=</span> <span class="s1">&#39;lwage ~ sex + shs+hsg+scl+clg+occ2+ind2+mw+so+we + (exp1+exp2+exp3+exp4)*(shs+hsg+scl+clg+occ2+ind2+mw+so+we)&#39;</span>
<span class="n">flex_results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">flex</span> <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assess the predictive performance</span>
<span class="n">R2_1</span> <span class="o">=</span> <span class="n">basic_results</span><span class="o">.</span><span class="n">rsquared</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R-squared for the basic model: &quot;</span><span class="p">,</span> <span class="n">R2_1</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">R2_adj1</span> <span class="o">=</span> <span class="n">basic_results</span><span class="o">.</span><span class="n">rsquared_adj</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;adjusted R-squared for the basic model: &quot;</span><span class="p">,</span> <span class="n">R2_adj1</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">R2_2</span> <span class="o">=</span> <span class="n">flex_results</span><span class="o">.</span><span class="n">rsquared</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R-squared for the basic model: &quot;</span><span class="p">,</span> <span class="n">R2_2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">R2_adj2</span> <span class="o">=</span> <span class="n">flex_results</span><span class="o">.</span><span class="n">rsquared_adj</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;adjusted R-squared for the basic model: &quot;</span><span class="p">,</span> <span class="n">R2_adj2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">R2_L</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">flex_results_0</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">lwage</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R-squared for LASSO: &quot;</span><span class="p">,</span> <span class="n">R2_L</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">R2_adjL</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">R2_L</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lwage</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lwage</span><span class="p">)</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;adjusted R-squared for LASSO: &quot;</span><span class="p">,</span> <span class="n">R2_adjL</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R-squared for the basic model:  0.31004650692219504 

adjusted R-squared for the basic model:  0.3032809304064292 

R-squared for the basic model:  0.3511098950617231 

adjusted R-squared for the basic model:  0.31869185352218843 

R-squared for LASSO:  0.1604784962552065 

adjusted R-squared for LASSO:  0.11835687889415825 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculating the MSE</span>
<span class="n">MSE1</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">basic_results</span><span class="o">.</span><span class="n">resid</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MSE for the basic model: &quot;</span><span class="p">,</span> <span class="n">MSE1</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">p1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">basic_results</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="c1"># number of regressors</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lwage</span><span class="p">)</span>
<span class="n">MSE_adj1</span>  <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">p1</span><span class="p">))</span><span class="o">*</span><span class="n">MSE1</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;adjusted MSE for the basic model: &quot;</span><span class="p">,</span> <span class="n">MSE_adj1</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">MSE2</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">flex_results</span><span class="o">.</span><span class="n">resid</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MSE for the flexible model: &quot;</span><span class="p">,</span> <span class="n">MSE2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">flex_results</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="c1"># number of regressors</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lwage</span><span class="p">)</span>
<span class="n">MSE_adj2</span>  <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">p2</span><span class="p">))</span><span class="o">*</span><span class="n">MSE2</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;adjusted MSE for the flexible model: &quot;</span><span class="p">,</span> <span class="n">MSE_adj2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">MSEL</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">lwage</span><span class="p">,</span> <span class="n">lwage_lasso_fitted</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MSE for the LASSO model: &quot;</span><span class="p">,</span> <span class="n">MSEL</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">pL</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># number of regressors</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lwage</span><span class="p">)</span>
<span class="n">MSE_adjL</span>  <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">pL</span><span class="p">))</span><span class="o">*</span><span class="n">MSEL</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;adjusted MSE for LASSO model: &quot;</span><span class="p">,</span> <span class="n">MSE_adjL</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MSE for the basic model:  0.22442505581164474 

adjusted MSE for the basic model:  0.22666974650519128 

MSE for the flexible model:  0.21106813644318256 

adjusted MSE for the flexible model:  0.22165597526149883 

MSE for the LASSO model:  0.273075884423059 

adjusted MSE for LASSO model:  0.2867742260968095 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Package for latex table </span>
<span class="kn">import</span> <span class="nn">array_to_latex</span> <span class="k">as</span> <span class="nn">a2l</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">R2_1</span><span class="p">,</span> <span class="n">MSE1</span><span class="p">,</span> <span class="n">R2_adj1</span><span class="p">,</span> <span class="n">MSE_adj1</span><span class="p">]</span>
<span class="n">table</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p2</span><span class="p">,</span> <span class="n">R2_2</span><span class="p">,</span> <span class="n">MSE2</span><span class="p">,</span> <span class="n">R2_adj2</span><span class="p">,</span> <span class="n">MSE_adj2</span><span class="p">]</span>
<span class="n">table</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pL</span><span class="p">,</span> <span class="n">R2_L</span><span class="p">,</span> <span class="n">MSEL</span><span class="p">,</span> <span class="n">R2_adjL</span><span class="p">,</span> <span class="n">MSE_adjL</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">,</span><span class="s2">&quot;$R^2_</span><span class="si">{sample}</span><span class="s2">$&quot;</span><span class="p">,</span><span class="s2">&quot;$MSE_</span><span class="si">{sample}</span><span class="s2">$&quot;</span><span class="p">,</span><span class="s2">&quot;$R^2_</span><span class="si">{adjusted}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="s2">&quot;$MSE_</span><span class="si">{adjusted}</span><span class="s2">$&quot;</span><span class="p">],</span> \
                      <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;basic reg&quot;</span><span class="p">,</span><span class="s2">&quot;flexible reg&quot;</span><span class="p">,</span> <span class="s2">&quot;lasso flex&quot;</span><span class="p">])</span>
<span class="n">table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p</th>
      <th>$R^2_{sample}$</th>
      <th>$MSE_{sample}$</th>
      <th>$R^2_{adjusted}$</th>
      <th>$MSE_{adjusted}$</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>basic reg</th>
      <td>51.0</td>
      <td>0.310047</td>
      <td>0.224425</td>
      <td>0.303281</td>
      <td>0.226670</td>
    </tr>
    <tr>
      <th>flexible reg</th>
      <td>246.0</td>
      <td>0.351110</td>
      <td>0.211068</td>
      <td>0.318692</td>
      <td>0.221656</td>
    </tr>
    <tr>
      <th>lasso flex</th>
      <td>246.0</td>
      <td>0.160478</td>
      <td>0.273076</td>
      <td>0.118357</td>
      <td>0.286774</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Considering all measures above, the flexible model performs slightly better than the basic model.</p>
<p>One procedure to circumvent this issue is to use <strong>data splitting</strong> that is described and applied in the following.</p>
</section>
<section id="data-splitting">
<h2><span class="section-number">2.6. </span>Data Splitting<a class="headerlink" href="#data-splitting" title="Permalink to this headline">#</a></h2>
<p>Measure the prediction quality of the two models via data splitting:</p>
<ul class="simple">
<li><p>Randomly split the data into one training sample and one testing sample. Here we just use a simple method (stratified splitting is a more sophisticated version of splitting that we can consider).</p></li>
<li><p>Use the training sample for estimating the parameters of the Basic Model and the Flexible Model.</p></li>
<li><p>Use the testing sample for evaluation. Predict the <span class="math notranslate nohighlight">\(\mathtt{wage}\)</span>  of every observation in the testing sample based on the estimated parameters in the training sample.</p></li>
<li><p>Calculate the Mean Squared Prediction Error <span class="math notranslate nohighlight">\(MSE_{test}\)</span> based on the testing sample for both prediction models.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import relevant packages for splitting data</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># Set Seed</span>
<span class="c1"># to make the results replicable (generating random numbers)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">random</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;random&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span>
<span class="n">random</span>    <span class="c1"># the array does not change </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2732, 2607, 1653, ..., 4184, 2349, 3462])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_2</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">])</span>
<span class="n">data_2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wage</th>
      <th>lwage</th>
      <th>sex</th>
      <th>shs</th>
      <th>hsg</th>
      <th>scl</th>
      <th>clg</th>
      <th>ad</th>
      <th>mw</th>
      <th>so</th>
      <th>...</th>
      <th>ne</th>
      <th>exp1</th>
      <th>exp2</th>
      <th>exp3</th>
      <th>exp4</th>
      <th>occ</th>
      <th>occ2</th>
      <th>ind</th>
      <th>ind2</th>
      <th>random</th>
    </tr>
    <tr>
      <th>rownames</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2223</th>
      <td>26.442308</td>
      <td>3.274965</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>1.0</td>
      <td>29.0</td>
      <td>8.4100</td>
      <td>24.389000</td>
      <td>70.728100</td>
      <td>340</td>
      <td>1</td>
      <td>8660</td>
      <td>20</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3467</th>
      <td>19.230769</td>
      <td>2.956512</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>1.0</td>
      <td>33.5</td>
      <td>11.2225</td>
      <td>37.595375</td>
      <td>125.944506</td>
      <td>9620</td>
      <td>22</td>
      <td>1870</td>
      <td>5</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13501</th>
      <td>48.076923</td>
      <td>3.872802</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0400</td>
      <td>0.008000</td>
      <td>0.001600</td>
      <td>3060</td>
      <td>10</td>
      <td>8190</td>
      <td>18</td>
      <td>0</td>
    </tr>
    <tr>
      <th>15588</th>
      <td>12.019231</td>
      <td>2.486508</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>29.0</td>
      <td>8.4100</td>
      <td>24.389000</td>
      <td>70.728100</td>
      <td>6440</td>
      <td>19</td>
      <td>770</td>
      <td>4</td>
      <td>2</td>
    </tr>
    <tr>
      <th>16049</th>
      <td>39.903846</td>
      <td>3.686473</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>12.0</td>
      <td>1.4400</td>
      <td>1.728000</td>
      <td>2.073600</td>
      <td>1820</td>
      <td>5</td>
      <td>7860</td>
      <td>17</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create training and testing sample </span>
<span class="n">train</span> <span class="o">=</span> <span class="n">data_2</span><span class="p">[</span> <span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mi">4</span><span class="o">/</span><span class="mi">5</span><span class="p">)]</span>    <span class="c1"># training sample</span>
<span class="n">test</span> <span class="o">=</span>  <span class="n">data_2</span><span class="p">[</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mi">4</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span> <span class="p">:</span> <span class="p">]</span>   <span class="c1"># testing sample</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(4120, 21)
(1030, 21)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic Model</span>
<span class="n">basic</span> <span class="o">=</span> <span class="s1">&#39;lwage ~ sex + exp1 + shs + hsg+ scl + clg + mw + so + we + occ2+ ind2&#39;</span>
<span class="n">basic_results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">basic</span> <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Flexible model </span>
<span class="n">flex</span> <span class="o">=</span> <span class="s1">&#39;lwage ~ sex + shs+hsg+scl+clg+occ2+ind2+mw+so+we + (exp1+exp2+exp3+exp4)*(shs+hsg+scl+clg+occ2+ind2+mw+so+we)&#39;</span>
<span class="n">flex_results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">flex</span> <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># basic model</span>
<span class="c1"># estimating the parameters in the training sample</span>
<span class="n">basic_results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">basic</span> <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">basic_results</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                  lwage   R-squared:                       0.316
Model:                            OLS   Adj. R-squared:                  0.308
Method:                 Least Squares   F-statistic:                     37.65
Date:                Sat, 23 Jul 2022   Prob (F-statistic):          4.85e-293
Time:                        14:05:29   Log-Likelihood:                -2784.1
No. Observations:                4120   AIC:                             5670.
Df Residuals:                    4069   BIC:                             5993.
Df Model:                          50                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      3.5365      0.061     58.134      0.000       3.417       3.656
occ2[T.10]    -0.0054      0.045     -0.120      0.904      -0.094       0.083
occ2[T.11]    -0.4594      0.067     -6.893      0.000      -0.590      -0.329
occ2[T.12]    -0.3300      0.061     -5.365      0.000      -0.451      -0.209
occ2[T.13]    -0.3767      0.050     -7.544      0.000      -0.475      -0.279
occ2[T.14]    -0.5026      0.056     -8.947      0.000      -0.613      -0.392
occ2[T.15]    -0.4511      0.059     -7.586      0.000      -0.568      -0.335
occ2[T.16]    -0.2482      0.036     -6.818      0.000      -0.320      -0.177
occ2[T.17]    -0.4286      0.031    -13.624      0.000      -0.490      -0.367
occ2[T.18]    -0.2957      0.216     -1.367      0.172      -0.720       0.128
occ2[T.19]    -0.2354      0.056     -4.191      0.000      -0.345      -0.125
occ2[T.2]     -0.0771      0.038     -2.029      0.043      -0.152      -0.003
occ2[T.20]    -0.2158      0.046     -4.669      0.000      -0.306      -0.125
occ2[T.21]    -0.3029      0.042     -7.171      0.000      -0.386      -0.220
occ2[T.22]    -0.4385      0.047     -9.385      0.000      -0.530      -0.347
occ2[T.3]     -0.0054      0.044     -0.121      0.904      -0.092       0.082
occ2[T.4]     -0.0867      0.061     -1.431      0.152      -0.206       0.032
occ2[T.5]     -0.2064      0.072     -2.866      0.004      -0.348      -0.065
occ2[T.6]     -0.4175      0.057     -7.317      0.000      -0.529      -0.306
occ2[T.7]     -0.0111      0.063     -0.177      0.860      -0.134       0.112
occ2[T.8]     -0.3633      0.049     -7.380      0.000      -0.460      -0.267
occ2[T.9]     -0.1928      0.052     -3.743      0.000      -0.294      -0.092
ind2[T.11]     0.0622      0.066      0.937      0.349      -0.068       0.192
ind2[T.12]     0.1328      0.060      2.220      0.026       0.016       0.250
ind2[T.13]     0.0492      0.078      0.629      0.529      -0.104       0.203
ind2[T.14]     0.0062      0.057      0.108      0.914      -0.106       0.118
ind2[T.15]    -0.1137      0.150     -0.759      0.448      -0.407       0.180
ind2[T.16]    -0.1072      0.063     -1.690      0.091      -0.232       0.017
ind2[T.17]    -0.1034      0.063     -1.640      0.101      -0.227       0.020
ind2[T.18]    -0.1331      0.058     -2.298      0.022      -0.247      -0.020
ind2[T.19]    -0.1591      0.073     -2.190      0.029      -0.301      -0.017
ind2[T.2]      0.2190      0.097      2.248      0.025       0.028       0.410
ind2[T.20]    -0.3512      0.064     -5.518      0.000      -0.476      -0.226
ind2[T.21]    -0.0824      0.062     -1.325      0.185      -0.204       0.040
ind2[T.22]     0.0795      0.060      1.321      0.186      -0.038       0.197
ind2[T.3]      0.0533      0.088      0.603      0.547      -0.120       0.227
ind2[T.4]     -0.0416      0.065     -0.636      0.525      -0.170       0.087
ind2[T.5]     -0.0628      0.063     -1.004      0.315      -0.185       0.060
ind2[T.6]     -0.0394      0.059     -0.673      0.501      -0.154       0.075
ind2[T.7]      0.0058      0.080      0.073      0.942      -0.152       0.163
ind2[T.8]     -0.0610      0.081     -0.754      0.451      -0.220       0.098
ind2[T.9]     -0.1683      0.055     -3.086      0.002      -0.275      -0.061
sex           -0.0763      0.017     -4.521      0.000      -0.109      -0.043
exp1           0.0087      0.001     11.758      0.000       0.007       0.010
shs           -0.5928      0.057    -10.436      0.000      -0.704      -0.481
hsg           -0.5213      0.030    -17.127      0.000      -0.581      -0.462
scl           -0.4215      0.028    -14.848      0.000      -0.477      -0.366
clg           -0.1974      0.026     -7.655      0.000      -0.248      -0.147
mw            -0.0233      0.022     -1.075      0.283      -0.066       0.019
so            -0.0428      0.021     -2.048      0.041      -0.084      -0.002
we         -5.145e-05      0.023     -0.002      0.998      -0.044       0.044
==============================================================================
Omnibus:                      358.629   Durbin-Watson:                   1.946
Prob(Omnibus):                  0.000   Jarque-Bera (JB):             1439.044
Skew:                           0.355   Prob(JB):                         0.00
Kurtosis:                       5.807   Cond. No.                         543.
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lwage_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s2">&quot;lwage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="c1">#test = test.drop(columns=[&#39;wage&#39;, &#39;lwage&#39;, &#39;random&#39;])</span>
<span class="c1">#test</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculating the out-of-sample MSE</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>   <span class="c1">#add constant </span>

<span class="n">lwage_pred</span> <span class="o">=</span>  <span class="n">basic_results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="c1"># predict out of sample</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lwage_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rownames
29749    2.454760
32504    2.729422
4239     3.374858
985      3.451121
8477     2.883054
           ...   
27533    3.039693
7218     2.669400
7204     3.271324
1380     2.943550
10451    3.462293
Length: 1030, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MSE_test1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">lwage_test</span><span class="o">-</span><span class="n">lwage_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">lwage_test</span><span class="p">)</span>
<span class="n">R2_test1</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">MSE_test1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">lwage_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test MSE for the basic model: &quot;</span><span class="p">,</span> <span class="n">MSE_test1</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test R2 for the basic model: &quot;</span><span class="p">,</span> <span class="n">R2_test1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test MSE for the basic model:  0.21963534669163998  
Test R2 for the basic model:  0.2749843118453724
</pre></div>
</div>
</div>
</div>
<p>In the basic model, the <span class="math notranslate nohighlight">\(MSE_{test}\)</span> is quite closed to the <span class="math notranslate nohighlight">\(MSE_{sample}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Flexible model</span>
<span class="c1"># estimating the parameters in the training sample</span>
<span class="n">flex_results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">flex</span> <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># calculating the out-of-sample MSE</span>
<span class="n">lwage_flex_pred</span> <span class="o">=</span>  <span class="n">flex_results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="c1"># predict out of sample</span>
<span class="n">lwage_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s2">&quot;lwage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">MSE_test2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">lwage_test</span><span class="o">-</span><span class="n">lwage_flex_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">lwage_test</span><span class="p">)</span>
<span class="n">R2_test2</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">MSE_test2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">lwage_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test MSE for the flexible model: &quot;</span><span class="p">,</span> <span class="n">MSE_test2</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test R2 for the flexible model: &quot;</span><span class="p">,</span> <span class="n">R2_test2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test MSE for the flexible model:  0.2332944574254996  
Test R2 for the flexible model:  0.2298956240842307
</pre></div>
</div>
</div>
</div>
<p>In the flexible model, the discrepancy between the <span class="math notranslate nohighlight">\(MSE_{test}\)</span> and the <span class="math notranslate nohighlight">\(MSE_{sample}\)</span> is not large.</p>
<p>It is worth to notice that the <span class="math notranslate nohighlight">\(MSE_{test}\)</span> vary across different data splits. Hence, it is a good idea average the out-of-sample MSE over different data splits to get valid results.</p>
<p>Nevertheless, we observe that, based on the out-of-sample <span class="math notranslate nohighlight">\(MSE\)</span>, the basic model using ols regression performs is about as well (or slightly better) than the flexible model.</p>
<p>Next, let us use lasso regression in the flexible model instead of ols regression. Lasso (<em>least absolute shrinkage and selection operator</em>) is a penalized regression method that can be used to reduce the complexity of a regression model when the number of regressors <span class="math notranslate nohighlight">\(p\)</span> is relatively large in relation to <span class="math notranslate nohighlight">\(n\)</span>.</p>
<p>Note that the out-of-sample <span class="math notranslate nohighlight">\(MSE\)</span> on the test sample can be computed for any other black-box prediction method as well. Thus, let us finally compare the performance of lasso regression in the flexible model to ols regression.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># flexible model using lasso</span>
<span class="c1"># get exogenous variables from training data used in flex model</span>
<span class="n">flex_results_0</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">flex</span> <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">flex_results_0</span><span class="o">.</span><span class="n">exog</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Get endogenous variable </span>
<span class="n">lwage_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s2">&quot;lwage&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lwage_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(4120, 246)
(4120,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># flexible model using lasso</span>
<span class="c1"># get exogenous variables from testing data used in flex model</span>
<span class="n">flex_results_1</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">flex</span> <span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">test</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">flex_results_1</span><span class="o">.</span><span class="n">exog</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Get endogenous variable </span>
<span class="n">lwage_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s2">&quot;lwage&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lwage_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1030, 246)
(1030,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculating the out-of-sample MSE</span>
<span class="n">reg</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">lwage_lasso_fitted</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">lwage_train</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="n">X_test</span> <span class="p">)</span>

<span class="n">MSE_lasso</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">lwage_test</span><span class="o">-</span><span class="n">lwage_lasso_fitted</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">lwage_test</span><span class="p">)</span>
<span class="n">R2_lasso</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">MSE_lasso</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">lwage_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test MSE for the flexible model: &quot;</span><span class="p">,</span> <span class="n">MSE_lasso</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test R2 for the flexible model: &quot;</span><span class="p">,</span> <span class="n">R2_lasso</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test MSE for the flexible model:  0.2540862168655473  
Test R2 for the flexible model:  0.1612620821455767
</pre></div>
</div>
</div>
</div>
<p>Finally, let us summarize the results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Package for latex table </span>
<span class="kn">import</span> <span class="nn">array_to_latex</span> <span class="k">as</span> <span class="nn">a2l</span>

<span class="n">table2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">table2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MSE_test1</span>
<span class="n">table2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MSE_test2</span>
<span class="n">table2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MSE_lasso</span>
<span class="n">table2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">R2_test1</span>
<span class="n">table2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">R2_test2</span>
<span class="n">table2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">R2_lasso</span>

<span class="n">table2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">table2</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;$MSE_</span><span class="si">{test}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="s2">&quot;$R^2_</span><span class="si">{test}</span><span class="s2">$&quot;</span><span class="p">],</span> \
                      <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;basic reg&quot;</span><span class="p">,</span><span class="s2">&quot;flexible reg&quot;</span><span class="p">,</span><span class="s2">&quot;lasso regression&quot;</span><span class="p">])</span>
<span class="n">table2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>$MSE_{test}$</th>
      <th>$R^2_{test}$</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>basic reg</th>
      <td>0.219635</td>
      <td>0.274984</td>
    </tr>
    <tr>
      <th>flexible reg</th>
      <td>0.233294</td>
      <td>0.229896</td>
    </tr>
    <tr>
      <th>lasso regression</th>
      <td>0.254086</td>
      <td>0.161262</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "d2cml-ai/14.388_py",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Python_notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="01_Python_Notebook_Linear_Model_Overfitting.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">1. </span>Linear Model Overfiting</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="03_ols-and-lasso-for-gender-wage-gap-inference.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3. </span>OLS and lasso for gender wage gap inference</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Victor Chernozhukov<br/>
  
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>