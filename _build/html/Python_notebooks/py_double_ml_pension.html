
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>67. Python: Impact of 401(k) on Financial Wealth &#8212; Inference on Causal and Structural Parametters Using ML and AI</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="&lt;no title&gt;" href="example_PySensemakr.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/main_logo_ai_light.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Inference on Causal and Structural Parametters Using ML and AI</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Machine Learning and Causal Inference
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_Python_Notebook_%20Linear_Model_Overfitting.html">
   1. Simple Exercise on Overfitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_PM1_Notebook1_Prediction_newdata.html">
   2. Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_PM1_Notebook_Inference.html">
   5. An inferential problem: The Gender Wage Gap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_py-notebook-vaccine-rcts.html">
   6. Vaccine RCT Examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_Analyzing_RCT_with_Precision.html">
   10. Analyzing RCT with Precision by Adjusting for Baseline Covariates
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_Analyzing_rct_reemployment_experiment.html">
   15. Analyzing RCT data with Precision Adjustment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_python_notebook_linear_penalized_regs.html">
   19. Penalized Linear Regressions: A Simulation Experiment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_python_notebook_experiment_on_orthogonal_learning.html">
   20. Simulation Design
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_pm2_notebook_jannis.html">
   21. Testing the Convergence Hypothesis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11_py-heterogenous-wage-effects.html">
   22. Application: Heterogeneous Effect of Gender on Wage Using Double Lasso
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13_pm3-notebook-newdata.html">
   23. A Simple Case Study using Wage Data from 2015
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="14_pm3_notebook_newdata_nn.html">
   24. A Simple Case Study using Wage Data from 2015 - proceeding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15_automl_for_wage_prediction.html">
   26. Automatic Machine Learning with H2O AutoML using Wage Data from 2015
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="16_py-Functional-Approximation-By-NN-and-RF.html">
   27. Functional Approximations by Trees and Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="17_notebook_dagitty.html">
   32. Causal Identification in DAGs using Backdoor and Swigs, Equivalence Classes, Falsifiability Tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="19_pm3_notebook_inference_clustering.html">
   33. A Case Study: The Effect of Gun Ownership on Gun-Homicide Rates
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="20_pm3_notebook_inference_nn.html">
   36. The Effect of Gun Ownership on Gun-Homicide Rates - proceeding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="21_pm5-401k-kaggle-py.html">
   38. Inference on Predictive and Causal Effects in High-Dimensional Nonlinear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="22_Identification%20Analysis%20of%20401%28k%29%20Example%20w%20DAGs.html">
   39. Identification Analysis of 401(k) Example w DAGs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="23_debiased-ml-for-partially-linear-model-in-python.html">
   40. Double/Debiased Machine Learning for the Partially Linear Regression Model.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="24_sensitivity_analysis_with_sensmakr_and_debiased_ml.html">
   42. Sensititivy Analysis for Unobserved Confounder with DML and Sensmakr
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="25_debiased-ml-for-partially-linear-iv-model-in-python.html">
   48. Double/Debiased ML for Partially Linear IV Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="27_r_weak_iv_experiments.html">
   56. A Simple Example of Properties of IV estimator when Instruments are Weak
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="average_treatment_effect_1.html">
   59. 1. ATE I: Binary treatment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Double_Machine_Learning.html">
   60. 1.0 The basics of double/debiased machine learning
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   67. Python: Impact of 401(k) on Financial Wealth
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/d2cml-ai/14.388_py/master?urlpath=tree/_build/jupyter_execute/Python_notebooks/py_double_ml_pension.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/d2cml-ai/14.388_py/blob/master/_build/jupyter_execute/Python_notebooks/py_double_ml_pension.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/d2cml-ai/14.388_py"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/d2cml-ai/14.388_py/issues/new?title=Issue%20on%20page%20%2FPython_notebooks/py_double_ml_pension.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/d2cml-ai/14.388_py/edit/master/_build/jupyter_execute/Python_notebooks/py_double_ml_pension.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/Python_notebooks/py_double_ml_pension.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data">
   67.1. Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-doubleml-package">
   67.2. The
   <code class="docutils literal notranslate">
    <span class="pre">
     DoubleML
    </span>
   </code>
   package
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#estimating-the-average-treatment-effect-of-401-k-eligibility-on-net-financial-assets">
   67.3. Estimating the Average Treatment Effect of 401(k) Eligibility on Net Financial Assets
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-data-backend-doublemldata">
     67.3.1. The Data Backend:
     <code class="docutils literal notranslate">
      <span class="pre">
       DoubleMLData
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#partially-linear-regression-model-plr">
     67.3.2. Partially Linear Regression Model (PLR)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interactive-regression-model-irm">
     67.3.3. Interactive Regression Model (IRM)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#local-average-treatment-effects-of-401-k-participation-on-net-financial-assets">
   67.4. Local Average Treatment Effects of 401(k) Participation on Net Financial Assets
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interactive-iv-model-iivm">
     67.4.1. Interactive IV Model (IIVM)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary-of-results">
   67.5. Summary of Results
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Python: Impact of 401(k) on Financial Wealth</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data">
   67.1. Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-doubleml-package">
   67.2. The
   <code class="docutils literal notranslate">
    <span class="pre">
     DoubleML
    </span>
   </code>
   package
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#estimating-the-average-treatment-effect-of-401-k-eligibility-on-net-financial-assets">
   67.3. Estimating the Average Treatment Effect of 401(k) Eligibility on Net Financial Assets
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-data-backend-doublemldata">
     67.3.1. The Data Backend:
     <code class="docutils literal notranslate">
      <span class="pre">
       DoubleMLData
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#partially-linear-regression-model-plr">
     67.3.2. Partially Linear Regression Model (PLR)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interactive-regression-model-irm">
     67.3.3. Interactive Regression Model (IRM)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#local-average-treatment-effects-of-401-k-participation-on-net-financial-assets">
   67.4. Local Average Treatment Effects of 401(k) Participation on Net Financial Assets
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interactive-iv-model-iivm">
     67.4.1. Interactive IV Model (IIVM)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary-of-results">
   67.5. Summary of Results
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="python-impact-of-401-k-on-financial-wealth">
<h1><span class="section-number">67. </span>Python: Impact of 401(k) on Financial Wealth<a class="headerlink" href="#python-impact-of-401-k-on-financial-wealth" title="Permalink to this headline">#</a></h1>
<p>In this real-data example, we illustrate how the <a class="reference external" href="https://docs.doubleml.org/stable/index.html">DoubleML</a> package can be used to estimate the effect of 401(k) eligibility and participation on accumulated assets. The 401(k) data set has been analyzed in several studies, among others <a class="reference external" href="https://arxiv.org/abs/1608.00060">Chernozhukov et al. (2018)</a>.</p>
<p>401(k) plans are pension accounts sponsored by employers. The key problem in determining the effect of participation in 401(k) plans on accumulated assets is saver heterogeneity coupled with the fact that the decision to enroll in a 401(k) is non-random. It is generally recognized that some people have a higher preference for saving than others. It also seems likely that those individuals with high unobserved preference for saving would be most likely to choose to participate in tax-advantaged retirement savings plans and would tend to have otherwise high amounts of accumulated assets. The presence of unobserved savings preferences with these properties then implies that conventional estimates that do not account for saver heterogeneity and endogeneity of participation will be biased upward, tending to overstate the savings effects of 401(k) participation.</p>
<p>One can argue that eligibility for enrolling in a 401(k) plan in this data can be taken as exogenous after conditioning on a few observables of which the most important for their argument is income. The basic idea is that, at least around the time 401(k)’s initially became available, people were unlikely to be basing their employment decisions on whether an employer offered a 401(k) but would instead focus on income and other aspects of the job.</p>
<section id="data">
<h2><span class="section-number">67.1. </span>Data<a class="headerlink" href="#data" title="Permalink to this headline">#</a></h2>
<p>The preprocessed data can be fetched by calling <a class="reference external" href="https://docs.doubleml.org/stable/api/generated/doubleml.datasets.fetch_401K.html#doubleml.datasets.fetch_401K">fetch_401K()</a>. Note that an internet connection is required for loading the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">doubleml</span> <span class="k">as</span> <span class="nn">dml</span>
<span class="kn">from</span> <span class="nn">doubleml.datasets</span> <span class="kn">import</span> <span class="n">fetch_401K</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LassoCV</span><span class="p">,</span> <span class="n">LogisticRegressionCV</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span><span class="p">,</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>

<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span><span class="p">,</span> <span class="n">XGBRegressor</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">Input In [1],</span> in <span class="ni">&lt;cell line: 3&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">doubleml</span> <span class="k">as</span> <span class="nn">dml</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">from</span> <span class="nn">doubleml.datasets</span> <span class="kn">import</span> <span class="n">fetch_401K</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;doubleml&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">7.5</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;axes.spines.top&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="s1">&#39;axes.spines.bottom&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="s1">&#39;axes.spines.left&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="s1">&#39;axes.spines.right&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">fetch_401K</span><span class="p">(</span><span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;DataFrame&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(9915, 14)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>nifa</th>
      <th>net_tfa</th>
      <th>tw</th>
      <th>age</th>
      <th>inc</th>
      <th>fsize</th>
      <th>educ</th>
      <th>db</th>
      <th>marr</th>
      <th>twoearn</th>
      <th>e401</th>
      <th>p401</th>
      <th>pira</th>
      <th>hown</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>9.915000e+03</td>
      <td>9.915000e+03</td>
      <td>9.915000e+03</td>
      <td>9915.000000</td>
      <td>9915.000000</td>
      <td>9915.000000</td>
      <td>9915.000000</td>
      <td>9915.000000</td>
      <td>9915.000000</td>
      <td>9915.000000</td>
      <td>9915.000000</td>
      <td>9915.000000</td>
      <td>9915.000000</td>
      <td>9915.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1.392864e+04</td>
      <td>1.805153e+04</td>
      <td>6.381685e+04</td>
      <td>41.060212</td>
      <td>37200.621094</td>
      <td>2.865860</td>
      <td>13.206253</td>
      <td>0.271004</td>
      <td>0.604841</td>
      <td>0.380837</td>
      <td>0.371357</td>
      <td>0.261624</td>
      <td>0.242158</td>
      <td>0.635199</td>
    </tr>
    <tr>
      <th>std</th>
      <td>5.490488e+04</td>
      <td>6.352250e+04</td>
      <td>1.115297e+05</td>
      <td>10.344505</td>
      <td>24774.289062</td>
      <td>1.538937</td>
      <td>2.810382</td>
      <td>0.444500</td>
      <td>0.488909</td>
      <td>0.485617</td>
      <td>0.483192</td>
      <td>0.439541</td>
      <td>0.428411</td>
      <td>0.481399</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000e+00</td>
      <td>-5.023020e+05</td>
      <td>-5.023020e+05</td>
      <td>25.000000</td>
      <td>-2652.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2.000000e+02</td>
      <td>-5.000000e+02</td>
      <td>3.291500e+03</td>
      <td>32.000000</td>
      <td>19413.000000</td>
      <td>2.000000</td>
      <td>12.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.635000e+03</td>
      <td>1.499000e+03</td>
      <td>2.510000e+04</td>
      <td>40.000000</td>
      <td>31476.000000</td>
      <td>3.000000</td>
      <td>12.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>8.765500e+03</td>
      <td>1.652450e+04</td>
      <td>8.148750e+04</td>
      <td>48.000000</td>
      <td>48583.500000</td>
      <td>4.000000</td>
      <td>16.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.430298e+06</td>
      <td>1.536798e+06</td>
      <td>2.029910e+06</td>
      <td>64.000000</td>
      <td>242124.000000</td>
      <td>13.000000</td>
      <td>18.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The data consist of 9,915 observations at the household level drawn from the 1991 Survey of Income and Program Participation (SIPP).  All the variables are referred to 1990. We use net financial assets (<em>net_tfa</em>) as the outcome variable, <span class="math notranslate nohighlight">\(Y\)</span>,  in our analysis. The net financial assets are computed as the sum of IRA balances, 401(k) balances, checking accounts, saving bonds, other interest-earning accounts, other interest-earning assets, stocks, and mutual funds less non mortgage debts.</p>
<p>Among the <span class="math notranslate nohighlight">\(9915\)</span> individuals, <span class="math notranslate nohighlight">\(3682\)</span> are eligible to participate in the program. The variable <em>e401</em> indicates eligibility and <em>p401</em> indicates participation, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;e401&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Eligibility, 401(k)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;e401&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/py_double_ml_pension_12_0.png" src="../_images/py_double_ml_pension_12_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;p401&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Participation, 401(k)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;p401&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/py_double_ml_pension_13_0.png" src="../_images/py_double_ml_pension_13_0.png" />
</div>
</div>
<p>Eligibility is highly associated with financial wealth:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;net_tfa&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;e401&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;e401&quot;</span><span class="p">,</span>
                <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;kde&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/py_double_ml_pension_15_0.png" src="../_images/py_double_ml_pension_15_0.png" />
</div>
</div>
<p>As a first estimate, we calculate the unconditional average predictive effect (APE) of 401(k) eligibility on accumulated assets. This effect corresponds to the average treatment effect if 401(k) eligibility would be assigned to individuals in an entirely randomized way. The unconditional APE of e401 is about <span class="math notranslate nohighlight">\(19559\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;e401&#39;</span><span class="p">,</span> <span class="s1">&#39;net_tfa&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;e401&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>net_tfa</th>
    </tr>
    <tr>
      <th>e401</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>19559.34375</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Among the <span class="math notranslate nohighlight">\(3682\)</span> individuals that  are eligible, <span class="math notranslate nohighlight">\(2594\)</span> decided to participate in the program. The unconditional APE of p401 is about <span class="math notranslate nohighlight">\(27372\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;p401&#39;</span><span class="p">,</span> <span class="s1">&#39;net_tfa&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;p401&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>net_tfa</th>
    </tr>
    <tr>
      <th>p401</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>27371.582031</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As discussed, these estimates are biased since they do not account for saver heterogeneity and endogeneity of participation.</p>
</section>
<section id="the-doubleml-package">
<h2><span class="section-number">67.2. </span>The <code class="docutils literal notranslate"><span class="pre">DoubleML</span></code> package<a class="headerlink" href="#the-doubleml-package" title="Permalink to this headline">#</a></h2>
<p>Let’s use the package <a class="reference external" href="https://docs.doubleml.org/stable/index.html">DoubleML</a> to estimate the average treatment effect of 401(k) eligibility, i.e. <code class="docutils literal notranslate"><span class="pre">e401</span></code>, and participation, i.e. <code class="docutils literal notranslate"><span class="pre">p401</span></code>, on net financial assets <code class="docutils literal notranslate"><span class="pre">net_tfa</span></code>.</p>
</section>
<section id="estimating-the-average-treatment-effect-of-401-k-eligibility-on-net-financial-assets">
<h2><span class="section-number">67.3. </span>Estimating the Average Treatment Effect of 401(k) Eligibility on Net Financial Assets<a class="headerlink" href="#estimating-the-average-treatment-effect-of-401-k-eligibility-on-net-financial-assets" title="Permalink to this headline">#</a></h2>
<p>We first look at the treatment effect of <code class="docutils literal notranslate"><span class="pre">e401</span></code> on net total financial assets. We give estimates of the ATE in the linear model</p>
<p>\begin{equation*}
Y = D \alpha + f(X)’\beta+ \epsilon,
\end{equation*}
where <span class="math notranslate nohighlight">\(f(X)\)</span> is a dictonary applied to the raw regressors. <span class="math notranslate nohighlight">\(X\)</span> contains variables on marital status, two-earner status, defined benefit pension status, IRA participation, home ownership, family size, education, age, and income.</p>
<p>In the following, we will consider two different models,</p>
<ul class="simple">
<li><p>a basic model specification that includes the raw regressors, i.e., <span class="math notranslate nohighlight">\(f(X) = X\)</span>, and</p></li>
<li><p>a flexible model specification, where <span class="math notranslate nohighlight">\(f(X)\)</span> includes the raw regressors <span class="math notranslate nohighlight">\(X\)</span> and the orthogonal polynomials of degree 2 for the variables family size education, age, and incuome.</p></li>
</ul>
<p>We will use the basic model specification whenever we use nonlinear methods, for example regression trees or random forests, and use the flexible model for linear methods such as the lasso. There are, of course, multiple ways how the model can be specified even more flexibly, for example including interactions of variable and higher order interaction. However, for the sake of simplicity we stick to the specification above. Users who are interested in varying the model can adapt the code below accordingly, for example to implement the orignal specification in Chernozhukov et al. (2018).</p>
<p>In the first step, we report estimates of the average treatment effect (ATE) of 401(k) eligibility on net financial assets both in the partially linear regression (PLR) model and in the interactive regression model (IRM) allowing for heterogeneous treatment effects.</p>
<section id="the-data-backend-doublemldata">
<h3><span class="section-number">67.3.1. </span>The Data Backend: <code class="docutils literal notranslate"><span class="pre">DoubleMLData</span></code><a class="headerlink" href="#the-data-backend-doublemldata" title="Permalink to this headline">#</a></h3>
<p>To start our analysis, we initialize the data backend, i.e., a new instance of a <a class="reference external" href="https://docs.doubleml.org/dev/api/generated/doubleml.DoubleMLData.html#doubleml.DoubleMLData">DoubleMLData</a> object. We implement the regression model by using scikit-learn’s <code class="docutils literal notranslate"><span class="pre">PolynomialFeatures</span></code> class.</p>
<p>To implement both models (basic and flexible), we generate two data backends: <code class="docutils literal notranslate"><span class="pre">data_dml_base</span></code> and <code class="docutils literal notranslate"><span class="pre">data_dml_flex</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up basic model: Specify variables for data-backend</span>
<span class="n">features_base</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;inc&#39;</span><span class="p">,</span> <span class="s1">&#39;educ&#39;</span><span class="p">,</span> <span class="s1">&#39;fsize&#39;</span><span class="p">,</span> <span class="s1">&#39;marr&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;twoearn&#39;</span><span class="p">,</span> <span class="s1">&#39;db&#39;</span><span class="p">,</span> <span class="s1">&#39;pira&#39;</span><span class="p">,</span> <span class="s1">&#39;hown&#39;</span><span class="p">]</span>

<span class="c1"># Initialize DoubleMLData (data-backend of DoubleML)</span>
<span class="n">data_dml_base</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
                                 <span class="n">y_col</span><span class="o">=</span><span class="s1">&#39;net_tfa&#39;</span><span class="p">,</span>
                                 <span class="n">d_cols</span><span class="o">=</span><span class="s1">&#39;e401&#39;</span><span class="p">,</span>
                                 <span class="n">x_cols</span><span class="o">=</span><span class="n">features_base</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data_dml_base</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== DoubleMLData Object ===
y_col: net_tfa
d_cols: [&#39;e401&#39;]
x_cols: [&#39;age&#39;, &#39;inc&#39;, &#39;educ&#39;, &#39;fsize&#39;, &#39;marr&#39;, &#39;twoearn&#39;, &#39;db&#39;, &#39;pira&#39;, &#39;hown&#39;]
z_cols: None
data:
 &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 9915 entries, 0 to 9914
Columns: 14 entries, nifa to hown
dtypes: float32(4), int8(10)
memory usage: 329.2 KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up a model according to regression formula with polynomials</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()[[</span><span class="s1">&#39;marr&#39;</span><span class="p">,</span> <span class="s1">&#39;twoearn&#39;</span><span class="p">,</span> <span class="s1">&#39;db&#39;</span><span class="p">,</span> <span class="s1">&#39;pira&#39;</span><span class="p">,</span> <span class="s1">&#39;hown&#39;</span><span class="p">]]</span>

<span class="n">poly_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
             <span class="s1">&#39;inc&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
             <span class="s1">&#39;educ&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
             <span class="s1">&#39;fsize&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">degree</span> <span class="ow">in</span> <span class="n">poly_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">poly</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">data_transf</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">key</span><span class="p">]])</span>
    <span class="n">x_cols</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">([</span><span class="n">key</span><span class="p">])</span>
    <span class="n">data_transf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_transf</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">x_cols</span><span class="p">)</span>
    
    <span class="n">features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">features</span><span class="p">,</span> <span class="n">data_transf</span><span class="p">),</span>
                          <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">model_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()[[</span><span class="s1">&#39;net_tfa&#39;</span><span class="p">,</span> <span class="s1">&#39;e401&#39;</span><span class="p">]],</span> <span class="n">features</span><span class="o">.</span><span class="n">copy</span><span class="p">()),</span>
                        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Initialize DoubleMLData (data-backend of DoubleML)</span>
<span class="n">data_dml_flex</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLData</span><span class="p">(</span><span class="n">model_data</span><span class="p">,</span> <span class="n">y_col</span><span class="o">=</span><span class="s1">&#39;net_tfa&#39;</span><span class="p">,</span> <span class="n">d_cols</span><span class="o">=</span><span class="s1">&#39;e401&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data_dml_flex</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== DoubleMLData Object ===
y_col: net_tfa
d_cols: [&#39;e401&#39;]
x_cols: [&#39;marr&#39;, &#39;twoearn&#39;, &#39;db&#39;, &#39;pira&#39;, &#39;hown&#39;, &#39;age&#39;, &#39;age^2&#39;, &#39;inc&#39;, &#39;inc^2&#39;, &#39;educ&#39;, &#39;educ^2&#39;, &#39;fsize&#39;, &#39;fsize^2&#39;]
z_cols: None
data:
 &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 9915 entries, 0 to 9914
Columns: 15 entries, net_tfa to fsize^2
dtypes: float32(3), float64(6), int8(6)
memory usage: 716.5 KB
</pre></div>
</div>
</div>
</div>
</section>
<section id="partially-linear-regression-model-plr">
<h3><span class="section-number">67.3.2. </span>Partially Linear Regression Model (PLR)<a class="headerlink" href="#partially-linear-regression-model-plr" title="Permalink to this headline">#</a></h3>
<p>We start using lasso to estimate the function <span class="math notranslate nohighlight">\(g_0\)</span> and <span class="math notranslate nohighlight">\(m_0\)</span> in the following PLR model:</p>
<p>\begin{eqnarray}
&amp; Y = D\theta_0 + g_0(X) + \zeta, &amp;\quad E[\zeta \mid D,X]= 0,\
&amp; D = m_0(X) +  V, &amp;\quad E[V \mid X] = 0.
\end{eqnarray}</p>
<p>To estimate the causal parameter <span class="math notranslate nohighlight">\(\theta_0\)</span> here, we use double machine learning with 3-fold cross-fitting.</p>
<p>Estimation of the nuisance components <span class="math notranslate nohighlight">\(g_0\)</span> and <span class="math notranslate nohighlight">\(m_0\)</span>, is based on the lasso with cross-validated choice of the penalty term , <span class="math notranslate nohighlight">\(\lambda\)</span>, as provided by <a class="reference external" href="https://scikit-learn.org">scikit-learn</a>. We load the learner by initializing instances from the classes <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LassoCV.html">LassoCV</a> and <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegressionCV.html">LogisticRegressionCV</a>. Hyperparameters and options can be set during instantiation of the learner. Here we specify that the lasso should use that value of <span class="math notranslate nohighlight">\(\lambda\)</span> that minimizes the cross-validated mean squared error which is based on 5-fold cross validation.</p>
<p>We start by estimation the ATE in the basic model and then repeat the estimation in the flexible model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize learners</span>
<span class="n">Cs</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">lasso</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">LassoCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">))</span>
<span class="n">lasso_class</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span>
                            <span class="n">LogisticRegressionCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span>
                                                 <span class="n">Cs</span> <span class="o">=</span> <span class="n">Cs</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="c1"># Initialize DoubleMLPLR model</span>
<span class="n">dml_plr_lasso</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLPLR</span><span class="p">(</span><span class="n">data_dml_base</span><span class="p">,</span>
                                <span class="n">ml_g</span> <span class="o">=</span> <span class="n">lasso</span><span class="p">,</span>
                                <span class="n">ml_m</span> <span class="o">=</span> <span class="n">lasso_class</span><span class="p">,</span>
                                <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">dml_plr_lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">store_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dml_plr_lasso</span><span class="o">.</span><span class="n">summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>t</th>
      <th>P&gt;|t|</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>e401</th>
      <td>5722.460811</td>
      <td>1380.579127</td>
      <td>4.144971</td>
      <td>0.000034</td>
      <td>3016.575445</td>
      <td>8428.346177</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Estimate the ATE in the flexible model with lasso</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">dml_plr_lasso</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLPLR</span><span class="p">(</span><span class="n">data_dml_flex</span><span class="p">,</span>
                                <span class="n">ml_g</span> <span class="o">=</span> <span class="n">lasso</span><span class="p">,</span>
                                <span class="n">ml_m</span> <span class="o">=</span> <span class="n">lasso_class</span><span class="p">,</span>
                                <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">dml_plr_lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">store_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lasso_summary</span> <span class="o">=</span> <span class="n">dml_plr_lasso</span><span class="o">.</span><span class="n">summary</span>

<span class="n">lasso_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>t</th>
      <th>P&gt;|t|</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>e401</th>
      <td>8974.791097</td>
      <td>1324.323636</td>
      <td>6.776887</td>
      <td>1.227932e-11</td>
      <td>6379.164467</td>
      <td>11570.417727</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Alternatively, we can repeat this procedure with other machine learning methods, for example a random forest learner as provided by the <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html">RandomForestRegressor</a> and <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html">RandomForestClassifier</a> class in <a class="reference external" href="https://scikit-learn.org">scikit-learn</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Random Forest</span>
<span class="n">randomForest</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">randomForest_class</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">dml_plr_forest</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLPLR</span><span class="p">(</span><span class="n">data_dml_base</span><span class="p">,</span>
                                 <span class="n">ml_g</span> <span class="o">=</span> <span class="n">randomForest</span><span class="p">,</span>
                                 <span class="n">ml_m</span> <span class="o">=</span> <span class="n">randomForest_class</span><span class="p">,</span>
                                 <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">dml_plr_forest</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">store_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">forest_summary</span> <span class="o">=</span> <span class="n">dml_plr_forest</span><span class="o">.</span><span class="n">summary</span>

<span class="n">forest_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>t</th>
      <th>P&gt;|t|</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>e401</th>
      <td>8909.634078</td>
      <td>1321.822289</td>
      <td>6.740417</td>
      <td>1.579322e-11</td>
      <td>6318.909997</td>
      <td>11500.358158</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now, let’s use a regression tree as provided in <a class="reference external" href="https://scikit-learn.org">scikit-learn</a>’s <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeRegressor.html">DecisionTreeRegressor</a> and <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeClassifier.html">DecisionTreeClassifier</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Trees</span>
<span class="n">trees</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ccp_alpha</span><span class="o">=</span><span class="mf">0.0047</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">203</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">67</span><span class="p">)</span>
<span class="n">trees_class</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ccp_alpha</span><span class="o">=</span><span class="mf">0.0042</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">104</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">34</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">dml_plr_tree</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLPLR</span><span class="p">(</span><span class="n">data_dml_base</span><span class="p">,</span>
                               <span class="n">ml_g</span> <span class="o">=</span> <span class="n">trees</span><span class="p">,</span>
                               <span class="n">ml_m</span> <span class="o">=</span> <span class="n">trees_class</span><span class="p">,</span>
                               <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">dml_plr_tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">store_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tree_summary</span> <span class="o">=</span> <span class="n">dml_plr_tree</span><span class="o">.</span><span class="n">summary</span>

<span class="n">tree_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>t</th>
      <th>P&gt;|t|</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>e401</th>
      <td>8260.06428</td>
      <td>1348.624798</td>
      <td>6.124805</td>
      <td>9.079458e-10</td>
      <td>5616.808246</td>
      <td>10903.320314</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can also experiment with extreme gradient boosting as provided by <a class="reference external" href="https://xgboost.readthedocs.io/en/latest/">xgboost</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Boosted Trees</span>
<span class="n">boost</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">objective</span> <span class="o">=</span> <span class="s2">&quot;reg:squarederror&quot;</span><span class="p">,</span>
                     <span class="n">eta</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span>
<span class="n">boost_class</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">use_label_encoder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">objective</span> <span class="o">=</span> <span class="s2">&quot;binary:logistic&quot;</span><span class="p">,</span> <span class="n">eval_metric</span> <span class="o">=</span> <span class="s2">&quot;logloss&quot;</span><span class="p">,</span>
                            <span class="n">eta</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">34</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">dml_plr_boost</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLPLR</span><span class="p">(</span><span class="n">data_dml_base</span><span class="p">,</span>
                                <span class="n">ml_g</span> <span class="o">=</span> <span class="n">boost</span><span class="p">,</span>
                                <span class="n">ml_m</span> <span class="o">=</span> <span class="n">boost_class</span><span class="p">,</span>
                                <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">dml_plr_boost</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">store_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">boost_summary</span> <span class="o">=</span> <span class="n">dml_plr_boost</span><span class="o">.</span><span class="n">summary</span>

<span class="n">boost_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>t</th>
      <th>P&gt;|t|</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>e401</th>
      <td>8816.895693</td>
      <td>1417.488971</td>
      <td>6.220081</td>
      <td>4.968995e-10</td>
      <td>6038.668362</td>
      <td>11595.123025</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s sum up the results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plr_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">lasso_summary</span><span class="p">,</span> <span class="n">forest_summary</span><span class="p">,</span> <span class="n">tree_summary</span><span class="p">,</span> <span class="n">boost_summary</span><span class="p">))</span>
<span class="n">plr_summary</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span> <span class="s1">&#39;forest&#39;</span><span class="p">,</span> <span class="s1">&#39;tree&#39;</span><span class="p">,</span> <span class="s1">&#39;xgboost&#39;</span><span class="p">]</span>
<span class="n">plr_summary</span><span class="p">[[</span><span class="s1">&#39;coef&#39;</span><span class="p">,</span> <span class="s1">&#39;2.5 %&#39;</span><span class="p">,</span> <span class="s1">&#39;97.5 %&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>lasso</th>
      <td>8974.791097</td>
      <td>6379.164467</td>
      <td>11570.417727</td>
    </tr>
    <tr>
      <th>forest</th>
      <td>8909.634078</td>
      <td>6318.909997</td>
      <td>11500.358158</td>
    </tr>
    <tr>
      <th>tree</th>
      <td>8260.064280</td>
      <td>5616.808246</td>
      <td>10903.320314</td>
    </tr>
    <tr>
      <th>xgboost</th>
      <td>8816.895693</td>
      <td>6038.668362</td>
      <td>11595.123025</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">plr_summary</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">plr_summary</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">plr_summary</span><span class="p">[</span><span class="s1">&#39;2.5 %&#39;</span><span class="p">]</span>
<span class="n">errors</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">plr_summary</span><span class="p">[</span><span class="s1">&#39;97.5 %&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">plr_summary</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">plr_summary</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">plr_summary</span><span class="o">.</span><span class="n">coef</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12500</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Partially Linear Regression Model (PLR)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ML method&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span>  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Coefficients and 95%-CI&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/py_double_ml_pension_45_0.png" src="../_images/py_double_ml_pension_45_0.png" />
</div>
</div>
</section>
<section id="interactive-regression-model-irm">
<h3><span class="section-number">67.3.3. </span>Interactive Regression Model (IRM)<a class="headerlink" href="#interactive-regression-model-irm" title="Permalink to this headline">#</a></h3>
<p>Next, we consider estimation of average treatment effects when treatment effects are fully heterogeneous:</p>
<p>\begin{eqnarray}
&amp; Y = g_0(D,X) + U, &amp;\quad E[U\mid X,D] = 0,\
&amp; D = m_0(X) + V, &amp;\quad E[V\mid X] = 0.
\end{eqnarray}</p>
<p>To reduce the disproportionate impact of extreme propensity score weights in the interactive model
we trim the propensity scores which are close to the bounds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lasso</span>
<span class="n">lasso</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">LassoCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">20000</span><span class="p">))</span>

<span class="c1"># Initialize DoubleMLIRM model</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">dml_irm_lasso</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLIRM</span><span class="p">(</span><span class="n">data_dml_flex</span><span class="p">,</span>
                          <span class="n">ml_g</span> <span class="o">=</span> <span class="n">lasso</span><span class="p">,</span>
                          <span class="n">ml_m</span> <span class="o">=</span> <span class="n">lasso_class</span><span class="p">,</span>
                          <span class="n">trimming_threshold</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
                          <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">dml_irm_lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">store_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
<span class="n">lasso_summary</span> <span class="o">=</span> <span class="n">dml_irm_lasso</span><span class="o">.</span><span class="n">summary</span>

<span class="n">lasso_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>t</th>
      <th>P&gt;|t|</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>e401</th>
      <td>7918.270136</td>
      <td>1206.438374</td>
      <td>6.563344</td>
      <td>5.261425e-11</td>
      <td>5553.694373</td>
      <td>10282.845898</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Random Forest</span>
<span class="n">randomForest</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">randomForest_class</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">dml_irm_forest</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLIRM</span><span class="p">(</span><span class="n">data_dml_base</span><span class="p">,</span>
                                 <span class="n">ml_g</span> <span class="o">=</span> <span class="n">randomForest</span><span class="p">,</span>
                                 <span class="n">ml_m</span> <span class="o">=</span> <span class="n">randomForest_class</span><span class="p">,</span>
                                 <span class="n">trimming_threshold</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
                                 <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># Set nuisance-part specific parameters</span>
<span class="n">dml_irm_forest</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_g0&#39;</span><span class="p">,</span> <span class="s1">&#39;e401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">})</span>
<span class="n">dml_irm_forest</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_g1&#39;</span><span class="p">,</span> <span class="s1">&#39;e401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>
<span class="n">dml_irm_forest</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_m&#39;</span><span class="p">,</span> <span class="s1">&#39;e401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">})</span>

<span class="n">dml_irm_forest</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">store_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
<span class="n">forest_summary</span> <span class="o">=</span> <span class="n">dml_irm_forest</span><span class="o">.</span><span class="n">summary</span>

<span class="n">forest_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>t</th>
      <th>P&gt;|t|</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>e401</th>
      <td>8020.190199</td>
      <td>1140.240133</td>
      <td>7.033773</td>
      <td>2.010222e-12</td>
      <td>5785.360605</td>
      <td>10255.019793</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Trees</span>
<span class="n">trees</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">trees_class</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">dml_irm_tree</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLIRM</span><span class="p">(</span><span class="n">data_dml_base</span><span class="p">,</span>
                               <span class="n">ml_g</span> <span class="o">=</span> <span class="n">trees</span><span class="p">,</span>
                               <span class="n">ml_m</span> <span class="o">=</span> <span class="n">trees_class</span><span class="p">,</span>
                               <span class="n">trimming_threshold</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
                               <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># Set nuisance-part specific parameters</span>
<span class="n">dml_irm_tree</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_g0&#39;</span><span class="p">,</span> <span class="s1">&#39;e401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;ccp_alpha&#39;</span><span class="p">:</span> <span class="mf">0.0016</span><span class="p">,</span> <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="mi">74</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">})</span>
<span class="n">dml_irm_tree</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_g1&#39;</span><span class="p">,</span> <span class="s1">&#39;e401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;ccp_alpha&#39;</span><span class="p">:</span> <span class="mf">0.0018</span><span class="p">,</span> <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">23</span><span class="p">})</span>
<span class="n">dml_irm_tree</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_m&#39;</span><span class="p">,</span> <span class="s1">&#39;e401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;ccp_alpha&#39;</span><span class="p">:</span> <span class="mf">0.0028</span><span class="p">,</span> <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="mi">167</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">55</span><span class="p">})</span>

<span class="n">dml_irm_tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">store_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tree_summary</span> <span class="o">=</span> <span class="n">dml_irm_tree</span><span class="o">.</span><span class="n">summary</span>

<span class="n">tree_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>t</th>
      <th>P&gt;|t|</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>e401</th>
      <td>8054.077008</td>
      <td>1184.437455</td>
      <td>6.799918</td>
      <td>1.046791e-11</td>
      <td>5732.622255</td>
      <td>10375.531761</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Boosted Trees</span>
<span class="n">boost</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">objective</span> <span class="o">=</span> <span class="s2">&quot;reg:squarederror&quot;</span><span class="p">)</span>
<span class="n">boost_class</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">use_label_encoder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">objective</span> <span class="o">=</span> <span class="s2">&quot;binary:logistic&quot;</span><span class="p">,</span> <span class="n">eval_metric</span> <span class="o">=</span> <span class="s2">&quot;logloss&quot;</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">dml_irm_boost</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLIRM</span><span class="p">(</span><span class="n">data_dml_base</span><span class="p">,</span>
                                <span class="n">ml_g</span> <span class="o">=</span> <span class="n">boost</span><span class="p">,</span>
                                <span class="n">ml_m</span> <span class="o">=</span> <span class="n">boost_class</span><span class="p">,</span>
                                <span class="n">trimming_threshold</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
                                <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># Set nuisance-part specific parameters</span>
<span class="n">dml_irm_boost</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_g0&#39;</span><span class="p">,</span> <span class="s1">&#39;e401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>
<span class="n">dml_irm_boost</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_g1&#39;</span><span class="p">,</span> <span class="s1">&#39;e401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">29</span><span class="p">})</span>
<span class="n">dml_irm_boost</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_m&#39;</span><span class="p">,</span> <span class="s1">&#39;e401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">23</span><span class="p">})</span>

<span class="n">dml_irm_boost</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">store_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">boost_summary</span> <span class="o">=</span> <span class="n">dml_irm_boost</span><span class="o">.</span><span class="n">summary</span>

<span class="n">boost_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>t</th>
      <th>P&gt;|t|</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>e401</th>
      <td>8232.06866</td>
      <td>1231.951289</td>
      <td>6.682138</td>
      <td>2.354809e-11</td>
      <td>5817.488503</td>
      <td>10646.648817</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">irm_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">lasso_summary</span><span class="p">,</span> <span class="n">forest_summary</span><span class="p">,</span> <span class="n">tree_summary</span><span class="p">,</span> <span class="n">boost_summary</span><span class="p">))</span>
<span class="n">irm_summary</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span> <span class="s1">&#39;forest&#39;</span><span class="p">,</span> <span class="s1">&#39;tree&#39;</span><span class="p">,</span> <span class="s1">&#39;xgboost&#39;</span><span class="p">]</span>
<span class="n">irm_summary</span><span class="p">[[</span><span class="s1">&#39;coef&#39;</span><span class="p">,</span> <span class="s1">&#39;2.5 %&#39;</span><span class="p">,</span> <span class="s1">&#39;97.5 %&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>lasso</th>
      <td>7918.270136</td>
      <td>5553.694373</td>
      <td>10282.845898</td>
    </tr>
    <tr>
      <th>forest</th>
      <td>8020.190199</td>
      <td>5785.360605</td>
      <td>10255.019793</td>
    </tr>
    <tr>
      <th>tree</th>
      <td>8054.077008</td>
      <td>5732.622255</td>
      <td>10375.531761</td>
    </tr>
    <tr>
      <th>xgboost</th>
      <td>8232.068660</td>
      <td>5817.488503</td>
      <td>10646.648817</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">irm_summary</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">irm_summary</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">irm_summary</span><span class="p">[</span><span class="s1">&#39;2.5 %&#39;</span><span class="p">]</span>
<span class="n">errors</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">irm_summary</span><span class="p">[</span><span class="s1">&#39;97.5 %&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">irm_summary</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">irm_summary</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">irm_summary</span><span class="o">.</span><span class="n">coef</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12500</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Interactive Regression Model (IRM)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ML method&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Coefficients and 95%-CI&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/py_double_ml_pension_55_0.png" src="../_images/py_double_ml_pension_55_0.png" />
</div>
</div>
<p>These estimates that flexibly account for confounding are
substantially attenuated relative to the baseline estimate (<em>19559</em>) that does not account for confounding. They suggest much smaller causal effects of 401(k) eligiblity on financial asset holdings. The best model with lowest RMSE in both equations is the PLR model estimated via lasso. It gives the following estimate:</p>
</section>
</section>
<section id="local-average-treatment-effects-of-401-k-participation-on-net-financial-assets">
<h2><span class="section-number">67.4. </span>Local Average Treatment Effects of 401(k) Participation on Net Financial Assets<a class="headerlink" href="#local-average-treatment-effects-of-401-k-participation-on-net-financial-assets" title="Permalink to this headline">#</a></h2>
<section id="interactive-iv-model-iivm">
<h3><span class="section-number">67.4.1. </span>Interactive IV Model (IIVM)<a class="headerlink" href="#interactive-iv-model-iivm" title="Permalink to this headline">#</a></h3>
<p>In the examples above, we estimated the average treatment effect of <em>eligibility</em> on financial asset holdings. Now, we consider estimation of local average treatment effects (LATE) of <em>participation</em> using eligibility as an instrument for the participation decision. Under appropriate assumptions, the LATE identifies the treatment effect for so-called compliers, i.e., individuals who would only participate if eligible and otherwise not participate in the program.</p>
<p>As before, <span class="math notranslate nohighlight">\(Y\)</span> denotes the outcome <code class="docutils literal notranslate"><span class="pre">net_tfa</span></code>, and <span class="math notranslate nohighlight">\(X\)</span> is the vector of covariates. We use <code class="docutils literal notranslate"><span class="pre">e401</span></code> as a binary instrument for the treatment variable <code class="docutils literal notranslate"><span class="pre">p401</span></code>. Here the structural equation model is:</p>
<p>\begin{eqnarray}
&amp; Y = g_0(Z,X) + U, &amp;\quad E[U\mid Z,X] = 0,\
&amp; D = r_0(Z,X) + V, &amp;\quad E[V\mid Z, X] = 0,\
&amp; Z = m_0(X) + \zeta, &amp;\quad E[\zeta \mid X] = 0.
\end{eqnarray}</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize DoubleMLData with an instrument</span>

<span class="c1"># Basic model</span>
<span class="n">data_dml_base_iv</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
                                    <span class="n">y_col</span><span class="o">=</span><span class="s1">&#39;net_tfa&#39;</span><span class="p">,</span>
                                    <span class="n">d_cols</span><span class="o">=</span><span class="s1">&#39;p401&#39;</span><span class="p">,</span>
                                    <span class="n">z_cols</span><span class="o">=</span><span class="s1">&#39;e401&#39;</span><span class="p">,</span>
                                    <span class="n">x_cols</span><span class="o">=</span><span class="n">features_base</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">data_dml_base_iv</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== DoubleMLData Object ===
y_col: net_tfa
d_cols: [&#39;p401&#39;]
x_cols: [&#39;age&#39;, &#39;inc&#39;, &#39;educ&#39;, &#39;fsize&#39;, &#39;marr&#39;, &#39;twoearn&#39;, &#39;db&#39;, &#39;pira&#39;, &#39;hown&#39;]
z_cols: [&#39;e401&#39;]
data:
 &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 9915 entries, 0 to 9914
Columns: 14 entries, nifa to hown
dtypes: float32(4), int8(10)
memory usage: 329.2 KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Flexible model</span>
<span class="n">model_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()[[</span><span class="s1">&#39;net_tfa&#39;</span><span class="p">,</span> <span class="s1">&#39;e401&#39;</span><span class="p">,</span> <span class="s1">&#39;p401&#39;</span><span class="p">]],</span> <span class="n">features</span><span class="o">.</span><span class="n">copy</span><span class="p">()),</span>
                        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">data_dml_iv_flex</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLData</span><span class="p">(</span><span class="n">model_data</span><span class="p">,</span>
                                    <span class="n">y_col</span><span class="o">=</span><span class="s1">&#39;net_tfa&#39;</span><span class="p">,</span>
                                    <span class="n">d_cols</span><span class="o">=</span><span class="s1">&#39;p401&#39;</span><span class="p">,</span>
                                    <span class="n">z_cols</span><span class="o">=</span><span class="s1">&#39;e401&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">data_dml_iv_flex</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== DoubleMLData Object ===
y_col: net_tfa
d_cols: [&#39;p401&#39;]
x_cols: [&#39;marr&#39;, &#39;twoearn&#39;, &#39;db&#39;, &#39;pira&#39;, &#39;hown&#39;, &#39;age&#39;, &#39;age^2&#39;, &#39;inc&#39;, &#39;inc^2&#39;, &#39;educ&#39;, &#39;educ^2&#39;, &#39;fsize&#39;, &#39;fsize^2&#39;]
z_cols: [&#39;e401&#39;]
data:
 &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 9915 entries, 0 to 9914
Columns: 16 entries, net_tfa to fsize^2
dtypes: float32(3), float64(6), int8(7)
memory usage: 726.2 KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lasso</span>
<span class="n">lasso</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">LassoCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">20000</span><span class="p">))</span>

<span class="c1"># Initialize DoubleMLIRM model</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">dml_iivm_lasso</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLIIVM</span><span class="p">(</span><span class="n">data_dml_iv_flex</span><span class="p">,</span>
                                  <span class="n">ml_g</span> <span class="o">=</span> <span class="n">lasso</span><span class="p">,</span>
                                  <span class="n">ml_m</span> <span class="o">=</span> <span class="n">lasso_class</span><span class="p">,</span>
                                  <span class="n">ml_r</span> <span class="o">=</span> <span class="n">lasso_class</span><span class="p">,</span>
                                  <span class="n">subgroups</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;always_takers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                             <span class="s1">&#39;never_takers&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                                  <span class="n">trimming_threshold</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
                                  <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">dml_iivm_lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">store_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lasso_summary</span> <span class="o">=</span> <span class="n">dml_iivm_lasso</span><span class="o">.</span><span class="n">summary</span>

<span class="n">lasso_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>t</th>
      <th>P&gt;|t|</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>p401</th>
      <td>11489.252169</td>
      <td>1747.417764</td>
      <td>6.574989</td>
      <td>4.865684e-11</td>
      <td>8064.376285</td>
      <td>14914.128053</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Again, we repeat the procedure for the other machine learning methods:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Random Forest</span>
<span class="n">randomForest</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">randomForest_class</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">dml_iivm_forest</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLIIVM</span><span class="p">(</span><span class="n">data_dml_base_iv</span><span class="p">,</span>
                                   <span class="n">ml_g</span> <span class="o">=</span> <span class="n">randomForest</span><span class="p">,</span>
                                   <span class="n">ml_m</span> <span class="o">=</span> <span class="n">randomForest_class</span><span class="p">,</span>
                                   <span class="n">ml_r</span> <span class="o">=</span> <span class="n">randomForest_class</span><span class="p">,</span>
                                   <span class="n">subgroups</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;always_takers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                                <span class="s1">&#39;never_takers&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                                   <span class="n">trimming_threshold</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
                                   <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># Set nuisance-part specific parameters</span>
<span class="n">dml_iivm_forest</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_g0&#39;</span><span class="p">,</span> <span class="s1">&#39;p401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">})</span>
<span class="n">dml_iivm_forest</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_g1&#39;</span><span class="p">,</span> <span class="s1">&#39;p401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>
<span class="n">dml_iivm_forest</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_m&#39;</span><span class="p">,</span> <span class="s1">&#39;p401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">})</span>
<span class="n">dml_iivm_forest</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_r1&#39;</span><span class="p">,</span> <span class="s1">&#39;p401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">})</span>

<span class="n">dml_iivm_forest</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">store_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
<span class="n">forest_summary</span> <span class="o">=</span> <span class="n">dml_iivm_forest</span><span class="o">.</span><span class="n">summary</span>

<span class="n">forest_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>t</th>
      <th>P&gt;|t|</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>p401</th>
      <td>11550.03435</td>
      <td>1638.022642</td>
      <td>7.051206</td>
      <td>1.773742e-12</td>
      <td>8339.568966</td>
      <td>14760.499734</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Trees</span>
<span class="n">trees</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">trees_class</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">dml_iivm_tree</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLIIVM</span><span class="p">(</span><span class="n">data_dml_base_iv</span><span class="p">,</span>
                                 <span class="n">ml_g</span> <span class="o">=</span> <span class="n">trees</span><span class="p">,</span>
                                 <span class="n">ml_m</span> <span class="o">=</span> <span class="n">trees_class</span><span class="p">,</span>
                                 <span class="n">ml_r</span> <span class="o">=</span> <span class="n">trees_class</span><span class="p">,</span>
                                 <span class="n">subgroups</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;always_takers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                              <span class="s1">&#39;never_takers&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                                 <span class="n">trimming_threshold</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
                                 <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># Set nuisance-part specific parameters</span>
<span class="n">dml_iivm_tree</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_g0&#39;</span><span class="p">,</span> <span class="s1">&#39;p401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;ccp_alpha&#39;</span><span class="p">:</span> <span class="mf">0.0016</span><span class="p">,</span> <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="mi">74</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">})</span>
<span class="n">dml_iivm_tree</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_g1&#39;</span><span class="p">,</span> <span class="s1">&#39;p401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;ccp_alpha&#39;</span><span class="p">:</span> <span class="mf">0.0018</span><span class="p">,</span> <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">23</span><span class="p">})</span>
<span class="n">dml_iivm_tree</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_m&#39;</span><span class="p">,</span> <span class="s1">&#39;p401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;ccp_alpha&#39;</span><span class="p">:</span> <span class="mf">0.0028</span><span class="p">,</span> <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="mi">167</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">55</span><span class="p">})</span>
<span class="n">dml_iivm_tree</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_r1&#39;</span><span class="p">,</span> <span class="s1">&#39;p401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;ccp_alpha&#39;</span><span class="p">:</span> <span class="mf">0.0576</span><span class="p">,</span> <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">})</span>

<span class="n">dml_iivm_tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">store_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tree_summary</span> <span class="o">=</span> <span class="n">dml_iivm_tree</span><span class="o">.</span><span class="n">summary</span>

<span class="n">tree_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>t</th>
      <th>P&gt;|t|</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>p401</th>
      <td>11512.640404</td>
      <td>1689.239802</td>
      <td>6.815279</td>
      <td>9.408106e-12</td>
      <td>8201.79123</td>
      <td>14823.489578</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Boosted Trees</span>
<span class="n">boost</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">objective</span> <span class="o">=</span> <span class="s2">&quot;reg:squarederror&quot;</span><span class="p">)</span>
<span class="n">boost_class</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">use_label_encoder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">objective</span> <span class="o">=</span> <span class="s2">&quot;binary:logistic&quot;</span><span class="p">,</span> <span class="n">eval_metric</span> <span class="o">=</span> <span class="s2">&quot;logloss&quot;</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">dml_iivm_boost</span> <span class="o">=</span> <span class="n">dml</span><span class="o">.</span><span class="n">DoubleMLIIVM</span><span class="p">(</span><span class="n">data_dml_base_iv</span><span class="p">,</span>
                                  <span class="n">ml_g</span> <span class="o">=</span> <span class="n">boost</span><span class="p">,</span>
                                  <span class="n">ml_m</span> <span class="o">=</span> <span class="n">boost_class</span><span class="p">,</span>
                                  <span class="n">ml_r</span> <span class="o">=</span> <span class="n">boost_class</span><span class="p">,</span>
                                  <span class="n">subgroups</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;always_takers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                               <span class="s1">&#39;never_takers&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                                  <span class="n">trimming_threshold</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
                                  <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># Set nuisance-part specific parameters</span>
<span class="n">dml_iivm_boost</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_g0&#39;</span><span class="p">,</span> <span class="s1">&#39;p401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">})</span>
<span class="n">dml_iivm_boost</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_g1&#39;</span><span class="p">,</span> <span class="s1">&#39;p401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">})</span>
<span class="n">dml_iivm_boost</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_m&#39;</span><span class="p">,</span> <span class="s1">&#39;p401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
<span class="n">dml_iivm_boost</span><span class="o">.</span><span class="n">set_ml_nuisance_params</span><span class="p">(</span><span class="s1">&#39;ml_r1&#39;</span><span class="p">,</span> <span class="s1">&#39;p401&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;eta&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">})</span>

<span class="n">dml_iivm_boost</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">store_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">boost_summary</span> <span class="o">=</span> <span class="n">dml_iivm_boost</span><span class="o">.</span><span class="n">summary</span>

<span class="n">boost_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>t</th>
      <th>P&gt;|t|</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>p401</th>
      <td>12412.530104</td>
      <td>1678.83551</td>
      <td>7.393536</td>
      <td>1.429752e-13</td>
      <td>9122.072968</td>
      <td>15702.987241</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iivm_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">lasso_summary</span><span class="p">,</span> <span class="n">forest_summary</span><span class="p">,</span> <span class="n">tree_summary</span><span class="p">,</span> <span class="n">boost_summary</span><span class="p">))</span>
<span class="n">iivm_summary</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span> <span class="s1">&#39;forest&#39;</span><span class="p">,</span> <span class="s1">&#39;tree&#39;</span><span class="p">,</span> <span class="s1">&#39;xgboost&#39;</span><span class="p">]</span>
<span class="n">iivm_summary</span><span class="p">[[</span><span class="s1">&#39;coef&#39;</span><span class="p">,</span> <span class="s1">&#39;2.5 %&#39;</span><span class="p">,</span> <span class="s1">&#39;97.5 %&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coef</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>lasso</th>
      <td>11489.252169</td>
      <td>8064.376285</td>
      <td>14914.128053</td>
    </tr>
    <tr>
      <th>forest</th>
      <td>11550.034350</td>
      <td>8339.568966</td>
      <td>14760.499734</td>
    </tr>
    <tr>
      <th>tree</th>
      <td>11512.640404</td>
      <td>8201.791230</td>
      <td>14823.489578</td>
    </tr>
    <tr>
      <th>xgboost</th>
      <td>12412.530104</td>
      <td>9122.072968</td>
      <td>15702.987241</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colors</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">iivm_summary</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">iivm_summary</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">iivm_summary</span><span class="p">[</span><span class="s1">&#39;2.5 %&#39;</span><span class="p">]</span>
<span class="n">errors</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">iivm_summary</span><span class="p">[</span><span class="s1">&#39;97.5 %&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">iivm_summary</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">iivm_summary</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">iivm_summary</span><span class="o">.</span><span class="n">coef</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16500</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Interactive IV Model (IIVM)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ML method&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Coefficients and 95%-CI&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/py_double_ml_pension_69_0.png" src="../_images/py_double_ml_pension_69_0.png" />
</div>
</div>
</section>
</section>
<section id="summary-of-results">
<h2><span class="section-number">67.5. </span>Summary of Results<a class="headerlink" href="#summary-of-results" title="Permalink to this headline">#</a></h2>
<p>To sum up, let’s merge all our results so far and illustrate them in a plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">plr_summary</span><span class="p">,</span> <span class="n">irm_summary</span><span class="p">,</span> <span class="n">iivm_summary</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;ML&#39;</span><span class="p">})</span>
<span class="n">df_summary</span><span class="p">[</span><span class="s1">&#39;Model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;PLR&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;IRM&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;IIVM&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
<span class="n">df_summary</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;ML&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>t</th>
      <th>P&gt;|t|</th>
      <th>2.5 %</th>
      <th>97.5 %</th>
    </tr>
    <tr>
      <th>Model</th>
      <th>ML</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="4" valign="top">PLR</th>
      <th>lasso</th>
      <td>8974.791097</td>
      <td>1324.323636</td>
      <td>6.776887</td>
      <td>1.227932e-11</td>
      <td>6379.164467</td>
      <td>11570.417727</td>
    </tr>
    <tr>
      <th>forest</th>
      <td>8909.634078</td>
      <td>1321.822289</td>
      <td>6.740417</td>
      <td>1.579322e-11</td>
      <td>6318.909997</td>
      <td>11500.358158</td>
    </tr>
    <tr>
      <th>tree</th>
      <td>8260.064280</td>
      <td>1348.624798</td>
      <td>6.124805</td>
      <td>9.079458e-10</td>
      <td>5616.808246</td>
      <td>10903.320314</td>
    </tr>
    <tr>
      <th>xgboost</th>
      <td>8816.895691</td>
      <td>1417.488971</td>
      <td>6.220081</td>
      <td>4.968995e-10</td>
      <td>6038.668360</td>
      <td>11595.123023</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">IRM</th>
      <th>lasso</th>
      <td>7918.270136</td>
      <td>1206.438374</td>
      <td>6.563344</td>
      <td>5.261425e-11</td>
      <td>5553.694373</td>
      <td>10282.845898</td>
    </tr>
    <tr>
      <th>forest</th>
      <td>8020.190199</td>
      <td>1140.240133</td>
      <td>7.033773</td>
      <td>2.010222e-12</td>
      <td>5785.360605</td>
      <td>10255.019793</td>
    </tr>
    <tr>
      <th>tree</th>
      <td>8054.077008</td>
      <td>1184.437455</td>
      <td>6.799918</td>
      <td>1.046791e-11</td>
      <td>5732.622255</td>
      <td>10375.531761</td>
    </tr>
    <tr>
      <th>xgboost</th>
      <td>8232.068660</td>
      <td>1231.951289</td>
      <td>6.682138</td>
      <td>2.354809e-11</td>
      <td>5817.488503</td>
      <td>10646.648817</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">IIVM</th>
      <th>lasso</th>
      <td>11489.252169</td>
      <td>1747.417764</td>
      <td>6.574989</td>
      <td>4.865684e-11</td>
      <td>8064.376285</td>
      <td>14914.128053</td>
    </tr>
    <tr>
      <th>forest</th>
      <td>11550.034350</td>
      <td>1638.022642</td>
      <td>7.051206</td>
      <td>1.773742e-12</td>
      <td>8339.568966</td>
      <td>14760.499734</td>
    </tr>
    <tr>
      <th>tree</th>
      <td>11512.640404</td>
      <td>1689.239802</td>
      <td>6.815279</td>
      <td>9.408106e-12</td>
      <td>8201.791230</td>
      <td>14823.489578</td>
    </tr>
    <tr>
      <th>xgboost</th>
      <td>12412.530104</td>
      <td>1678.835510</td>
      <td>7.393536</td>
      <td>1.429752e-13</td>
      <td>9122.072968</td>
      <td>15702.987241</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell tag_nbsphinx-thumbnail docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()</span>
<span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;PLR&#39;</span><span class="p">,</span> <span class="s1">&#39;IRM&#39;</span><span class="p">,</span> <span class="s1">&#39;IIVM&#39;</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ind</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">this_df</span> <span class="o">=</span> <span class="n">df_summary</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;Model == @model&#39;</span><span class="p">)</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">this_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">this_df</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">this_df</span><span class="p">[</span><span class="s1">&#39;2.5 %&#39;</span><span class="p">]</span>
    <span class="n">errors</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">this_df</span><span class="p">[</span><span class="s1">&#39;97.5 %&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">this_df</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">this_df</span><span class="o">.</span><span class="n">ML</span><span class="p">,</span> <span class="n">this_df</span><span class="o">.</span><span class="n">coef</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">ecolor</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16500</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Coefficients and 95%-CI&#39;</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;ML method&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/py_double_ml_pension_73_0.png" src="../_images/py_double_ml_pension_73_0.png" />
</div>
</div>
<p>We report results based on four ML methods for estimating the nuisance functions used in
forming the orthogonal estimating equations. We find again that the estimates of the treatment effect are stable across ML methods. The estimates are highly significant, hence we would reject the hypothesis
that 401(k) participation has no effect on financial wealth.</p>
<hr class="docutils" />
<p><strong>Acknowledgement</strong></p>
<p>We would like to thank <a class="reference external" href="https://www.bwl.uni-hamburg.de/en/statistik/team/kueck.html">Jannis Kueck</a> for sharing <a class="reference external" href="https://www.kaggle.com/janniskueck/pm5-401k">the kaggle notebook</a>. The pension data set has been analyzed in several studies, among others <a class="reference external" href="https://arxiv.org/abs/1608.00060">Chernozhukov et al. (2018)</a>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "d2cml-ai/14.388_py",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Python_notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="example_PySensemakr.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">&lt;no title&gt;</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Victor Chernozhukov<br/>
  
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>